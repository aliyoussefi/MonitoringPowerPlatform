# Monitoring the Power Platform: Power Automate - Run Time Part 2: Tracked Properties and Error Handling

## Summary

**[Microsoft Power Automate](https://docs.microsoft.com/en-us/power-automate/getting-started)** is a service allowing makers to create business processes, orchestrations and workflows to help achieve common and even complex business requirements. Within the Power Platform, Power Automate represents one of the most important pillars of the platform. It provides a no to low code solution to process automation. From sending **[push notifications to mobile devices](https://docs.microsoft.com/en-us/powerapps/maker/canvas-apps/add-notifications)**, to complex **[robotic process automation](https://flow.microsoft.com/en-us/ui-flows/)** flows, Power Automate can be used in virtually any workload.

If you have not already reviewed Part 1 in the Power Automate Run Time series, please do so as this article is a continuation of previous installments. In this article we will discuss **Tracked Properties** and how they can be used across actions with a Microsoft Power Automate Flow. We will then look into handling and capturing error information within actions to help troubleshoot and report on failing actions or flows. Finally we will examine the Try, Catch, Finally pattern and result function for monitoring insights.

## Action Tracked Properties

**Tracked Properties** are part of every action within Power Automate. [They provide the ability to add properties behind the scenes that can be referenced as part of the specific action.](http://johnliu.net/blog/2018/10/hiding-your-microsoft-flow-valuables-i-mean-variables-out-of-sight) With tracked properties, we can set variables such as time stamps, trigger headers and outputs, action outputs, or even previous tracked properties from earlier actions. Expressions, such as "utcNow, outputs, actions" can be used to track what normally wouldn't be stored in action inputs. [Tracked properties are packaged within a node in the action and can easily be referenced, reducing clutter.](https://powerusers.microsoft.com/t5/General-Power-Automate/Approval-Flow-Tracked-Properties/td-p/237387)

Consider the image below which shows capturing the status code and API throttle information for a List Records action in the **Common Data Service (current environment)** connector.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/PowerAutomate//TrackedProps/TrackedProperties-ActionAndActions.JPG"  />

A key point here is that the action function will work for tracking current action data but not previous actions with the actions function. Attempting to do so will result in the **"Tracked properties can only reference its own action's inputs and outputs, trigger inputs and outputs and parameters."** error.

<inser cde image TrackEdprop-action and actions>

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/PowerAutomate/PowerAutomate-Triggers-CDS.JPG" style="zoom:50%;" />

Using "utcNow()" as a tracked property for an action creates an interesting result. At first impression, we would be led to believe this may represent the start time of an action. However, when reviewing the output this function actually produces the end time exactly as if we were to reference it from the output of the action. Consider the below gif:

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/PowerAutomate//TrackedProps/TrackedProperties-UtcNow-EndTime.gif"  />

You can see that the five second delay is showing the tracked property "FiveSecondDelay" as the same timestamp as the endTime from the output!

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/PowerAutomate//TrackedProps/TrackedProperties-UtcNow-EndTimeCompareToStartTime.JPG"  />

Finally, as we look to **Azure Logic Apps** and what may come with **Microsoft Power Automate**, we can see how tracked properties work with monitoring solutions. **Azure Logic Apps** can [connect to Azure Log Analytics natively](https://docs.microsoft.com/en-us/azure/logic-apps/monitor-logic-apps-log-analytics) to log logic app runs. One way to extend the information stored in the log store is to [use Tracked Properties](https://docs.microsoft.com/en-us/azure/logic-apps/monitor-logic-apps-log-analytics#extend-data). When

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/PowerAutomate//TrackedProps/logic-app-run-details.png"  />

### Handling and Capturing Errors in Actions

Typically **Microsoft Power Automate** flows will fail out if an issue occurs. Manually we can review these failures in the Power Automate Portal or with PowerShell. However inside the Power Automate flow we have the ability to track the *statusCode* within the actions function. Along with the **Configure Run After** setting we can conditionally capture any error messages and report or store for analysis.

<img src="https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/PowerAutomate/MockError-HTTP-ConfigureRunAfter.JPG" />

The Configure Run After setting allows the flow to continue if an error occurs. This can be used in conjunction with the below image showing a conditional based on status of the output body:

<img src="https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/PowerAutomate/MockError-HTTP-Designer-Conditional.JPG" />

This documentation from Azure Logic Apps does a great job detailing the "run after" behavior.

https://docs.microsoft.com/en-us/azure/logic-apps/logic-apps-exception-handling



### Mock Responses

Integration actions can be simulate responses which can be helpful to troubleshoot without invoking a live system or for designing error handling.

<img src="https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/PowerAutomate/MockError-DevOps-StaticResult.JPG" />

### Try, Catch, Finally Pattern

https://sharepains.com/2020/03/06/get-the-result-of-your-failed-actions/

### Result Function

https://docs.microsoft.com/en-us/azure/logic-apps/workflow-definition-language-functions-reference#result

https://docs.microsoft.com/en-us/azure/logic-apps/logic-apps-exception-handling#get-results-from-failures

### Throttling with Azure Logic Apps

https://docs.microsoft.com/en-us/azure/logic-apps/handle-throttling-problems-429-errors

### Webhook Tester Site

To help with debugging, you can add diagnostic steps to a logic app workflow, along with reviewing the trigger and runs history. For example, you can add steps that use the [Webhook Tester](https://webhook.site/) service so that you can inspect HTTP requests and determine their exact size, shape, and format.

1. Go to the [Webhook Tester](https://webhook.site/) site and copy the generated unique URL.
2. In your logic app, add an HTTP POST action plus the body content that you want to test, for example, an expression or another step output.
3. Paste your URL from Webhook Tester into the HTTP POST action.
4. To review how a request is formed when generated from the Logic Apps engine, run the logic app, and revisit the Webhook Tester site for more details.

### The Workflow Run Object

To find out more about the specific run, you can cast the *workflow().run* object as a variable and view the properties. Run properties include the **id**, the **name**, and the **type**. This information, specifically the "**name**" property, can be correlated to the *ClientTrackingId* found in the **Get-FlowRun** cmdlet which we cover in the next article. 

<img src="https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/PowerAutomate/Workflow-Run-Overview.JPG" style="zoom:50%;" />

ddddd



### Utilizing a system provided Correlation Id

Power Automate also includes its own correlation identifiers as referenced in the Get-FlowRun cmdlet as part of the *ClientTrackingId*. This identifier can be obtained in the flow itself by use of the outputs object. Consider using this or a custom tracking identifier when working with external integrations to assist with application and workload monitoring. By implementing this early, the beginnings of an application map can appear when working with Azure Application Insights.

<insert app map image>

<img src="https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/PowerAutomate/Trigger-Object-Recurrance-JSON.JPG" style="zoom:50%;" />



## Next Steps

In this article we have covered foundational information and concepts for **Connectors**, **Connections** and **Data Loss Prevention Policies**. We have discussed some of the boundaries and limitations to be aware of. Examples of working with the **Power Apps Admin Portal** as well as the **PowerApps Administration PowerShell modules** were examined.

This article is a good starting point to better understanding how to work with powerful connectors such as the **Power Automate Management and Admin connectors** referenced in a future article. The article also begins the journey into the **Power Automate API** and how **solution layers can impact changes to components**.

If you are interested in learning more about [**specialized guidance and training** for monitoring or other areas of the Power Platform](https://community.dynamics.com/crm/b/crminthefield/posts/pfe-dynamics-365-service-offerings), which includes a [monitoring workshop](https://community.dynamics.com/cfs-file/__key/communityserver-blogs-components-weblogfiles/00-00-00-17-38/WorkshopPLUS-_2D00_-Dynamics-365-Customer-Engagement-Monitoring-with-Application-lnsights-1-Day-with-Lab_2D00_FA5D599F_2D00_20E4_2D00_4087_2D00_A713_2D00_39FBD14DF7E5.pdf), please contact your **Technical Account Manager** or **Microsoft representative** for further details. 

Your feedback is **<u>extremely valuable</u>** so please leave a comment below and I'll be happy to help where I can! Also, if you find any inconsistencies, omissions or have suggestions, [please go here to submit a new issue](https://github.com/aliyoussefi/MonitoringPowerPlatform/issues).

## Index

[Monitoring the Power Platform: Introduction and Index](https://community.dynamics.com/crm/b/crminthefield/posts/monitoring-the-power-platform-introduction)