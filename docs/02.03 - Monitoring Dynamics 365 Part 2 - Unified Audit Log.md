# Monitoring the Power Platform: Monitoring Power Apps Model Apps Part 1

## Summary

The idea of monitoring Dynamics 365 or Model Driven Applications is not a new concept. Understanding where services are failing, users are running into errors, where form and business processes could be tuned for performance are key drivers for most if not all businesses, from small companies to enterprises. Luckily, the Dynamics 365 platform provides many tools to help audit and monitor business and operational events.

This article will cover locating and downloading environment analytics using the Common Data Service for Analytics. Questions regarding capacity and all up usage can be answered here. For operational events the Release Wave 1 2020 for Power Apps will be explored for feature announcement to allow for both manual and automated gathering. For specific activities or workloads within the platform we will explore tools to capture and explain performance markers.

## Audits and Activity Data

Auditing allows administrators the ability to track changes to Dynamics 365 data and user interactions with the system. This article isn't meant to cover how auditing works or everything that auditing provides, I did want to point out common concerns I've seen. In this section we will cover the Unified Audit Log and Common Data Service for Analytics specifically. Be aware there are other ways to audit in Dynamics, a good starting point if you're not familiar or want a handy reference is here: [Auditing overview](https://docs.microsoft.com/en-us/powerapps/developer/common-data-service/auditing-overview). To configure auditing, please refer to this article: [Configure entities and attributes for auditing](https://docs.microsoft.com/en-us/powerapps/developer/common-data-service/configure-entities-attributes-auditing)

### Unified Audit Log

Starting with Dynamics 365, the capability to perform comprehensive logging for the Power Platform including Dynamics 365, Canvas Apps, Power Automate and Power BI. Some of the activities tracked are admin events such as provisioning instances and publishing customizations. User activities include viewing grids or multiple records (e.g. export to excel), CRUD operations, reading reports, etc. The list as the feature indicates is very comprehensive and can highlight specific actions taken by specific users at specific times. There are licensing requirements and Dynamics 365 organization requirements to be aware of before this can be enabled. For additional references on the requirements, please see the reference link below.

Reference: [Enable and use Activity Logging](https://docs.microsoft.com/en-us/power-platform/admin/enable-use-comprehensive-auditing)

To view this data there are two popular mechanisms, one is a way to track manually while the other provides a programmatic approach. The Office 365 Security and Compliance Portal allows admins to review the activity logs and export data. This portal is helpful to understand what activities can be searched and extracted programmatically with the API or PowerShell tooling.

#### Office 365 Security and Compliance Portal

This reference includes information about all of the services audited with the security and compliance center and how long the expected latency is for each.

[Search the audit log in the Security & Compliance Center](https://docs.microsoft.com/en-us/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance?view=o365-worldwide)

User and admin activity for virtually all of the Office 365 family, including connected services like Microsoft Teams, Microsoft Forms and Microsoft Exchange Online can be viewed along side activity within the Power Platform.

The Portal allows compliance administrators the ability to run audit search, filter to specific activities and export the results to a file.

#### Office 365 Management Activity API Reference

The Office 365 Management Activity API is a RESTful API allowing for a search of the audit log for monitoring and analytical purposes. The API allows developers to start and stop subscriptions to events and to retrieve content scoped to a particular service. Once configured the subscription will notify interested parties on activities allowing for these activities to be pushed to your monitoring platform.

To get started you'll need to authenticate with Azure AD using OAuth2. Here's a reference to the instructions to set this up: [Get started with Office 365 Management APIs](https://docs.microsoft.com/en-us/office/office-365-management-api/get-started-with-office-365-management-apis)

A reference to both how to connect and request data as well as schema definitions are found below.

[Office 365 Management Activity API reference](https://docs.microsoft.com/en-us/office/office-365-management-api/office-365-management-activity-api-reference)

[Office 365 Management Activity API schema](https://docs.microsoft.com/en-us/office/office-365-management-api/office-365-management-activity-api-schema)

#### Office 365 PowerShell usage

The Exchange Online PowerShell v2 Module contains a cmdlet called "Search-UnifiedAuditLog" that can help search Office 365 audit and activity data. 

[Search-UnifiedAuditLog](https://docs.microsoft.com/en-us/powershell/module/exchange/policy-and-compliance-audit/search-unifiedauditlog?view=exchange-ps)

The schema reference for the Activity API above will be helpful for searching for Dynamics, Power Apps, or Power Automate activities.

```
PS cmdlet
```



### Organization Insights / CDS for Analytics

A Common Data Service specific feature is the former Organization Insights or now called the Common Data Service for Analytics or CDS-A. Its key to point out here that Organization Insights will no longer be supported in future releases per [this document](https://docs.microsoft.com/en-us/power-platform/admin/analytics-common-data-service). Some of the key analytics compiled include active user usage and operations performed, customizations used, storage consumed and failed workflows and API calls.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/CDSA/CDSA-Overview-Tabs.JPG)

The Home dashboard includes the ability to filter to specific environments and time range to help focus on finding out more about a particular question. Active Users, API Calls and Pass rate are shown as well as top plug-ins by failure.

<img src="https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/CDSA/CDSA-Download-AvailableOptions.JPG" style="zoom:50%;" />

The Active Users pane is helpful to seeing which users are active during what timeframe and what operations are being performed.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/CDSA/CDSA-Overview-ActiveUsers.JPG)

Shown below is another chart I find useful, the Most used API showing the number

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/CDSA/CDSA-Overview-API-MostUsedAPI.JPG)

[Common Data Service analytics](https://docs.microsoft.com/en-us/power-platform/admin/analytics-common-data-service)



### Common Data Service for Analytics PowerShell cmdlets

Starting in July 2020 the PowerShell cmdlets for Power Apps will be general available allowing for automation of tasks typically performed in the Power Platform Admin Center. 

[PowerShell cmdlets for Power Apps admins are generally available](https://docs.microsoft.com/en-us/power-platform-release-plan/2020wave1/power-platform-governance-administration/powershell-cmdlets-power-apps-admins-are-generally)

According to the article, new cmdlets will be available allowing for managing capacity, user permissions and lifecycle operations for an environment. 

References:

[PowerShell cmdlets for Power Automate admins are generally available](https://docs.microsoft.com/en-us/power-platform-release-plan/2020wave1/power-platform-governance-administration/powershell-cmdlets-power-automate-admins-are-generally)

### Service Health within the Power Platform Admin Center

Recently announced in the Release Wave 1 for 2020 is a unified service health experience within the PPAC. This will allow admins the ability to focus efforts within the PPAC and not have to navigate to the Office 365 Portal or build automation for service health. This can also provide the potential to limit the environment admins from interacting with Office 365 items like Active Users and Licenses, Groups, Subscriptions, etc.

References:

[Service health in the Power Platform admin center](https://docs.microsoft.com/en-us/power-platform-release-plan/2020wave1/power-platform-governance-administration/service-health-power-platform-admin-center)

[Unified service health experience in Power Platform admin center](https://docs.microsoft.com/en-us/power-platform-release-plan/2020wave1/power-platform-governance-administration/unified-service-health-experience-power-platform-admin-center)

## Collecting User Interface Events

Before we discuss techniques on how to capture events in Dynamics 365 let's examine some meaningful events. From the client perspective this may include performance counters and metrics, user click events and navigation as well as geolocations and preferences of users. 

Some features of the platform allow for collecting markers while other events of interest we will have to supplement with custom delivery mechanisms. The next section of this article will detail a powerful tool that can be leveraged to collect metrics for the Dynamics 365 platform, the Performance Center.

## Performance Center

The Performance Center in Dynamics is a tool that can help analyze interactions with the platform such as opening a view, opening a form, saving a record, etc. The tool captures these events as well as external calls to other systems, web resources, images, that are requested by the form viewed by the user. These events are stacked in a timeline styled approach allowing us to see the chronological call stack.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/Capture.JPG)

In the image above we see the recent work blocks which represent events collected by the performance center. Each work block includes events and key performance indicators (KPI) that can be extracted and examined. Also key to point out is that the performance center can span across user actions including navigating forms, views, etc. and each work block can be pinned.

The following image shows the **EditForm**, **SaveForm** and **Dialog page** events. These represent the form load (**EditForm**), the save event (**SaveForm**) and the opening of a modal dialog (**Dialog page**).

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-DialogForm-Overview.JPG)

Clicking into a work block will populate the timeline area in the window. Each row is called a Zone which is a collection of specific events such as BrowserResourceTimings, WebService calls, etc.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-DialogForm-Overview.JPG)

In the following example, three work blocks that include Key Performance Indicators, are pinned and examined. The **BrowserResourceTimings** zone is expanded upon to determine additional or long running events.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/PerfCenter-ViewMarkers-CompareBrowserResourceTimings.gif)

### Key Performance Indicators and Metadata

Each work block contains timeline events, metadata, tags and key performance indicators. For the most part the metadata and KPI nodes contain relevant information when reviewing performance of a specific work block. The metadata will include the user agent, what version of the client and server and estimated latency. Also included are session and activity identifiers as well as other markers which are helpful when troubleshooting.

<img src="https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/PerfCenter-SaveForm-Metadata_and_KPI.JPG" style="zoom:50%;" />

The KPI node includes the name and duration of the event in the work block. In the image above we see the *SaveForm* event took 812 milliseconds.

In the image below we see the timeline window within the Performance Center showing the KPI flags. Clicking on the flag at the top of the window will populate the event window in the bottom right of the Performance Center for analysis.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-SaveForm-Timeline-KPI-AllRibbonsInit.JPG)

Within this event for AllRibbonsInitialized we see values specific to the KPI such as *LoadQuality*, *NumberOfRibbons* and *CleanLoad* among others. These markers can help us better understand if any caching took place, if this ribbon was initially loaded with this event and the cleanliness of the form load.

#### Attribution

On certain Key Performance Indicators a property is included call "Attribution". This includes the commands  or actions included within the KPI.

<insert Attribution image>

The image above shows for the FormSave KPI. Compare that image with the one below.

<insert Attribution image2>

This scenario came up during an investigation into the an increased duration of the FormSave KPI. Upon review, you can see additional events occurred, *tabstatechanged* and *onchange*. By reviewing the Attribution property we were able to identify what caused the increase.

### Timeline Events

Timeline events represent the flow of the work block captured and ca

#### How to turn on the Performance Center

These metrics can be retrieved by adding the *perf=true* query string parameter to the Dynamics 365 URL:

```
https://<your org>.crm.dynamics.com/main.aspx?perf=true
```

Also depending on the browser there exists a keystroke combination but I would recommend using the query string parameter where applicable. The keystroke combination for Microsoft Edge and Google Chrome is *Alt+Shift+Q*.

#### Collecting information from the Performance Center

The Performance Center includes the ability to export the data points collected in both json and csv formats. When clicked a new tab will appear with data points from the work block selected. This is key to call out to ensure you are collecting from the specific event (i.e. SaveForm) of interest.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/PerfCenter-ViewMarkers.gif)

Extracting the markers is helpful when you may not know exactly what you're looking for and need additional time to evaluate what exactly is going on. The KPI section will show the marker name and time during the user action it happened but to find out more an analysis of the timeline events is required. 

Consider the scenario of a user logging into the system and opening a lead form for the first time. When performing this action the form and data have not had a chance to be cached or stored locally which results in all items needed to be downloaded. This is sometimes referenced as a cold load. Reviewing the timeline event "**FullLoad**" we can determine what type of load the form rendered as.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-FormLoad-ColdLoad-JSON.JPG)

Now, once captured, the user opens the fly out window to choose another lead record but using the same form. Again using the "**FullLoad**" KPI timeline event we can see the *LoadType* is now two.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-FormLoad-WarmLoad-JSON.JPG)

Finally, imagine the user needs to navigate back to the original lead record opened on the same form. We can see now the *LoadType* is now three.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-FormLoad-HotLoad-JSON.JPG)

Comparing the cold load versus the cached form and data load:

<img src="https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-Compare-ColdLoad-WarmLoad-KPI.JPG" style="zoom:70%;" />



## Next Steps

In this article we covered 