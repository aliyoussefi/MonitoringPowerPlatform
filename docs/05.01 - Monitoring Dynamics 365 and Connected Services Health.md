# Monitoring Dynamics 365 and Connected Services Health

## Summary

Staying up to date on organization health is key to all online deployment within the Dynamics ecosphere. This is not limited to the platform itself but to the key components used to authenticate, to provide business continuity and to broker messages and data.

## Alerting on Azure Services

#### *Azure Status*

The [Azure Status Homepage](https://azure.microsoft.com/status/) provides you with a global view of the health of Azure services. With Azure status, you can get up-to-the-minute information on service availability. Everyone has access to Azure status and can view all services that report their service health. 

<img src=" https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Azure-Status-Front-Page.png" style="zoom: 50%;" />

Here you can view all of the data centers by region for current health and [previous statues](https://azure.microsoft.com/en-us/status/history/). The statuses can be broken down into specific categories such as:

- The class of service health notification (Service issues, Planned maintenance, Health advisories).
- The subscription affected.
- The service(s) affected.
- The region(s) affected.

The Azure Status page also provides a helpful [RSS feed](https://azurestatuscdn.azureedge.net/en-us/status/feed/) which can be subscribed to for notifications on changes to service health. This feed can be added to most readers or application that have reader capabilities such as Outlook. 



#### *Stay Up to Date utilizing workloads located outside of Azure*

[While viewing the current status of Azure Services](https://status.azure.com/en-us/status) is a great way to see current health it requires the human element to review and take action. One technique can be to rely on the RSS feed and trigger off of changes using workloads outside of Azure such as IF This Then That (IFTTT.org). 

<img src=" https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/IFTTT-Azure-Status-Feed.JPG" style="zoom:33%;" />

Another option is to follow the official Azure Status Twitter feed (which can also be automated) to get broadcasted updates.

<img src=" https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Azure-Status-Twitter.JPG" style="zoom:33%;" />

#### *Service Health Notifications*

<img src=" https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Health-Monitoring-Heart.png" style="zoom: 50%;" />

Using Azure Monitor we can setup alerts that will notify or even automate preventive workloads. Imagine a scenario where a resource such as Azure Active Directory that is heavily relied on is in a state of degradation. In the past, solutions to check for this state may have included design patterns like [Health Endpoint Monitoring](https://docs.microsoft.com/en-us/azure/architecture/patterns/health-endpoint-monitoring) consistently monitoring health. Utilizing Azure Monitor we can attempt to use this same pattern in a scheduled approach used only when truly needed. 

The thing to understand with Azure Monitor Alerts is that they can be configured to notify on practically anything in Azure from subscriptions, service health, resources, logs and events. Each is configured somewhat differently and its key to realize what scope each of these types of alerts cover.

**NOTE: Service health notifications does not send an alert regarding resource health events.**

To configure Service Health notifications please refer to this link: [Configuring Service Health Notifications](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/alerts-activity-log-service-notifications?toc=%2Fazure%2Fresource-health%2Ftoc.json)

## Identifying and Alerting for Azure Connected Candidates

Candidates include but are not limited to:

*Azure Active Directory*

*Azure Functions*

*Azure Event Hubs*

*Azure Service Bus*

*Azure Logic Apps*

*Azure Data Factory*

*Azure Data Lake*

*Azure SQL Server*

*Azure Resource Groups*

At a minimum I'd suggest monitoring Azure Active Directory as it serves as the front door to almost all Office 365 Business Applications.

### Stay Informed with Azure Resource Health

[Azure Resource Health keeps you informed about the current and historical health status of your Azure resources. Azure Resource Health alerts can notify you in near real-time when these resources have a change in their health status. Creating Resource Health alerts programmatically allow for users to create and customize alerts in bulk.](https://docs.microsoft.com/en-us/azure/service-health/resource-health-alert-arm-template-guide)

Some of the highlights here include:

•Configure health notifications for existing problem management systems using a webhook to send to external systems such as ServiceNow, PagerDuty, OpsGenie, etc.

•Get Resource Health using the REST API

•Configure resource health alerts using Resource Manager templates

***References***

What is Resource Health?

[Azure Resource Health overview](https://docs.microsoft.com/en-us/azure/service-health/resource-health-overview)

Resource Health FAQ:

[Azure Resource Health FAQ](https://docs.microsoft.com/en-us/azure/service-health/resource-health-faq)

Resource Health API

[Reducing troubleshooting time with Azure Resource health](https://azure.microsoft.com/en-us/blog/reduce-troubleshooting-time-with-azure-resource-health/)

Example: [Get Resource Health using the REST API](https://docs.microsoft.com/en-us/azure/service-health/service-health-rest)

## Alerting on Office 365 Services

Doing a bit of research I stumbled upon the [Office 365 Service Communications API](https://msdn.microsoft.com/en-us/library/office/dn776043.aspx). Reviewing this I found that there are two separate endpoints with their own authorization mechanisms, service contracts, etc. resulting in the [Office 365 Service Communications API](https://msdn.microsoft.com/en-us/library/office/dn776043.aspx) and the preview version of the [Office 365 Service Communications API](https://msdn.microsoft.com/office-365/office-365-service-communications-api-reference).

The major thing I've seen through my work consuming both of the APIs is one requires an Office 365 Service Administrator or a partner role acting on behalf of (AOBO) for authentication while the other uses OAuth. This means one will use a username and password similar to logging into Office 365 while the other will use a client id and client secret. 

The API can alert on current and historical status as well as messages from the various platforms. These alerts can be filtered to specific workloads such as Dynamics 365 or SharePoint.

Here's a reference to a blog post on the PFE blog CRM in the Field: https://community.dynamics.com/crm/b/crminthefield/archive/2018/06/13/monitoring-dynamics-365-ce-service-health-and-messages-using-the-microsoft-office-365-service-communications-api

**References:**

[Get started with Office 365 Management APIs](https://msdn.microsoft.com/en-us/office-365/get-started-with-office-365-management-apis)

[About Office 365 Admin Roles](https://support.office.com/en-us/article/About-Office-365-admin-roles-da585eea-f576-4f55-a1e0-87090b6aaa9d)

[Office 365 Service Communications API Overview](https://msdn.microsoft.com/en-us/library/office/dn776043.aspx)

[Office 365 Service Communications API Sample Code](https://www.microsoft.com/en-us/download/details.aspx?id=44012)

[Office 365 Service Communications API Overview (preview)](https://msdn.microsoft.com/office-365/office-365-service-communications-api-reference)



## Conclusion

After reviewing the Azure Status page, Service and Resource Health alerting for Azure and the Office 365 Service Communication API we should have covered monitoring both Dynamics and connected resource health. The key takeaway here is that these techniques described help us stay proactive and informed on what's going on with our platform's health in an automated approach. 

I also touched on how to monitor Azure from workloads residing on different cloud providers in hopes to provide continuous monitoring in a worst case scenario for Azure as a whole.

Finally, its important to note that this article is for monitoring health and not APM or activity logging.