<h2 class="md-end-block md-heading"><span class="md-plain">Summary</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">Monitoring </span><span class="md-pair-s "><strong><span class="md-plain">Dynamics 365</span></strong></span><span class="md-plain"> or </span><span class="md-pair-s "><strong><span class="md-plain">Model Driven Applications</span></strong></span><span class="md-plain"> is not a new concept. Understanding where services are failing, users are running into errors, where form and business processes could be tuned for performance are key drivers for most if not all businesses, from small companies to enterprises. Luckily, the </span><span class="md-pair-s "><strong><span class="md-plain">Dynamics 365</span></strong></span><span class="md-plain"> platform provides many tools to help audit and monitor business and operational events.</span></p>
<p class="md-end-block md-p"><span class="md-plain">This article will cover </span><span class="md-pair-s "><strong><span class="md-plain">collecting, querying and analyzing user interface events</span></strong></span><span class="md-plain">, specifically from the </span><span class="md-meta-i-c  md-link"><a href="https://powerapps.microsoft.com/en-us/blog/monitor-now-supports-model-driven-apps/" rel="noopener noreferrer" target="_blank"><span class="md-plain">recently announced Monitor Tool for Model Driven Apps</span></a></span><span class="md-plain">. </span><span class="md-meta-i-c  md-link"><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-model-driven-apps---monitor-tool-part-1-messages-and-scenarios" rel="noopener noreferrer" target="_blank"><span class="md-plain">The previous article</span></a></span><span class="md-plain md-expand"> covered message data points and how to perceive them. In this go round, we will have a little fun exploring ways to utilize the output sessions. We will discuss how to build robust work items in </span><span class="md-pair-s "><strong><span class="md-plain">Azure DevOps</span></strong></span><span class="md-plain"> with </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> output. We'll look at consuming and storing outputs for visualizations and analytics with </span><span class="md-pair-s "><strong><span class="md-plain">Kusto</span></strong></span><span class="md-plain"> queries. Finally, samples will be provided to parse and load session messages into </span><span class="md-pair-s "><strong><span class="md-plain">Azure Application Insights</span></strong></span><span class="md-plain"> and </span><span class="md-pair-s "><strong><span class="md-plain">Azure Log Analytics</span></strong></span><span class="md-plain">.</span></p>
<h2 class="md-end-block md-heading"><span class="md-plain">The Monitor Tool</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-pair-s"><strong><u><span class="md-plain">The Monitor Tool allows users and team members to collect messages and work together in debugging sessions</span></u></strong></span><span class="md-plain">. To begin, the </span><span class="md-pair-s"><strong><span class="md-plain">Monitor Tool</span></strong></span><span class="md-plain"> can be launched from the </span><span class="md-pair-s "><strong><span class="md-plain">Power Apps Maker Portal</span></strong></span><span class="md-plain">. Once launched, the </span><span class="md-pair-s "><strong><em><span class="md-plain">Play Model Driven App</span></em></strong></span><span class="md-plain"> button can be pressed to begin a session attached to the tool.</span></p>
<p class="md-end-block md-p" style="padding-left: 240px;"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/PlayModelDrivenApp.PNG"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/d90ba68e_2D00_f094_2D00_4706_2D00_a4c1_2D00_31b065ffa8c0-245500-complete/pastedimage1597357184199v1.png" /></span></p>
<p class="md-end-block md-p"><span class="md-plain">The </span><span class="md-pair-s "><strong><span class="md-plain">Monitor Tool</span></strong></span><span class="md-plain"> can also be started by adding &ldquo;</span><span class="md-pair-s "><strong><span class="md-plain">&amp;monitor=true</span></strong></span><span class="md-plain">&rdquo; to the URL of your </span><span class="md-pair-s "><strong><span class="md-plain">Model Driven Application</span></strong></span><span class="md-plain">.</span></p>
<p class="md-end-block md-p"><span class="md-plain">After consenting or allowing to start a session, the </span><span class="md-pair-s"><strong><span class="md-plain">Monitor Tool</span></strong></span><span class="md-plain"> will light up rapidly with various messages. Similar to </span><span class="md-meta-i-c  md-link"><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-canvas-driven-apps---the-monitoring-tool" rel="noopener noreferrer" target="_blank"><span class="md-plain">the "</span><span class="md-pair-s "><strong><span class="md-plain">Canvas Driven Apps - The Monitoring Tool</span></strong></span><span class="md-plain">" article</span></a></span><span class="md-plain">, each row can be further drilled into for investigation.</span></p>
<p class="md-end-block md-p" style="padding-left: 240px;"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/RowDetailFullLoad.PNG"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/d90ba68e_2D00_f094_2D00_4706_2D00_a4c1_2D00_31b065ffa8c0-245500-complete/pastedimage1597357184200v2.png" /></span></p>
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://powerapps.microsoft.com/en-us/blog/author/jeparson/" rel="noopener noreferrer" target="_blank"><span class="md-plain">Jesse Parsons'</span></a></span><span class="md-plain"> article on the </span><span class="md-pair-s "><strong><span class="md-plain">Monitor Tool</span></strong></span><span class="md-plain">, titled </span><span class="md-meta-i-c  md-link"><a href="https://powerapps.microsoft.com/en-us/blog/monitor-now-supports-model-driven-apps/" rel="noopener noreferrer" target="_blank"><span class="md-plain">'</span><span class="md-pair-s "><strong><span class="md-plain">Monitor now supports model-driven apps</span></strong></span><span class="md-plain">'</span></a></span><span class="md-plain"> provides a through deep dive including sample scenarios. </span><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">I highly suggest reviewing and keeping close by for reference.</span></u></span></strong></span></p>
<h3 class="md-end-block md-heading"><span class="md-plain">Thoughts on Canvas Apps</span></h3>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">The </span><span class="md-pair-s"><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool works with </span><span class="md-pair-s "><strong><span class="md-plain">Power Apps Canvas Driven Apps</span></strong></span><span class="md-plain"> as shown in </span><span class="md-meta-i-c  md-link"><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-canvas-driven-apps---the-monitoring-tool" rel="noopener noreferrer" target="_blank"><span class="md-plain">the article "</span><span class="md-pair-s "><strong><span class="md-plain">Canvas Driven Apps - The Monitoring Tool</span></strong></span><span class="md-plain">".</span></a></span><span class="md-plain"> While this article is focused on </span><span class="md-pair-s "><strong><span class="md-plain">Model Driven Apps</span></strong></span><span class="md-plain">, </span><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">remember these techniques can also be utilized to serve Canvas Apps as well.</span></u></span></strong></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain">Consuming Monitor Sessions</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">Each time the </span><span class="md-pair-s"><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool is opened, a new session is created. Within each session are events that describe actions taken within the session as well as other helpful messages. Storing these </span><span class="md-pair-s "><strong><span class="md-plain">sessions allow support teams to better understand errors and issues</span></strong></span><span class="md-plain"> that arise during testing and production workloads. The previous article, </span><span class="md-meta-i-c  md-link"><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-model-driven-apps---monitor-tool-part-1-messages-and-scenarios" rel="noopener noreferrer" target="_blank"><span class="md-plain">"</span><span class="md-pair-s "><strong><span class="md-plain">Monitor Tool Part 1: Messages and Scenarios</span></strong></span><span class="md-plain">"</span></a></span><span class="md-plain"> covers scenarios that support users can use to better understand the data points delivered in the </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> Tool.</span></p>
<p class="md-end-block md-p"><span class="md-plain">The </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool can also help analysts who want to learn more about the platform. For instance, user tendencies such as how long they spent on a page and which controls they interacted with in </span><span class="md-pair-s "><strong><span class="md-plain">Canvas Driven Apps</span></strong></span><span class="md-plain">. For testing, the tool can help with non functional test strategies like </span><span class="md-pair-s "><strong><span class="md-plain">A/B testing</span></strong></span><span class="md-plain">. Analyzing performance messages can </span><span class="md-pair-s"><strong><span class="md-plain">point to potential code coverage gaps or advise on user experience impact</span></strong></span><span class="md-plain">. </span><span class="md-pair-s "><strong><span class="md-plain">Network calls can be securitized to determine if queries can be optimized</span></strong></span><span class="md-plain"> or web resources minified. </span><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">The Monitor tool, in my opinion, really can open up a new view on how the platform is consumed and how users react with it.</span></u></span></strong></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain">Attaching to Azure DevOps Work Items</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">The </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> Tool download artifacts work nicely with </span><span class="md-pair-s "><strong><span class="md-plain">Azure DevOps Work Items</span></strong></span><span class="md-plain">. They can be </span><span class="md-pair-s "><strong><span class="md-plain">attached to Bugs, Tasks and even Test Cases</span></strong></span><span class="md-plain"> when performing exploratory or other types of tests.</span></p>
<p class="md-end-block md-p" style="padding-left: 300px;"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/MonitorTool.DevOpsWorkItem.PNG"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/d90ba68e_2D00_f094_2D00_4706_2D00_a4c1_2D00_31b065ffa8c0-245500-complete/pastedimage1597357184200v3.png" /></span></p>
<p class="md-end-block md-p"><span class="md-plain">Working with test cases within </span><span class="md-pair-s "><strong><span class="md-plain">Azure DevOps</span></strong></span><span class="md-plain">, Analysts craft work items with use cases and expected outcomes to deliver to Makers and Developers. Specifically with Test Cases, </span><span class="md-pair-s "><strong><span class="md-plain">Quality Analysts can leverage the Monitor Tool in conjunction with the </span><span class="md-meta-i-c  md-link"><a href="https://marketplace.visualstudio.com/items?itemName=ms.vss-exploratorytesting-web" rel="noopener noreferrer" target="_blank"><span class="md-plain">Test and Feedback Browser Extension</span></a></span><span class="md-plain">.</span></strong></span><span class="md-plain"> This allows for robust </span><span class="md-pair-s "><strong><span class="md-plain">test cases complete with steps, screenshots, client information and the Monitor Tool output attached</span></strong></span><span class="md-plain">. Consider the gif below showing an example of using both the browser extension and the </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool output.</span></p>
<p class="md-end-block md-p"><span class="md-plain"><img alt="" height="572" src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/AttachMonitorOutputToDevOpsBug.gif" width="961" /></span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/AttachMonitorOutputToDevOpsBug.gif"></span></p>
<p class="md-end-block md-p"><span class="md-plain">In that example, we see an analyst has found a performance issue with a </span><span class="md-pair-s "><strong><span class="md-plain">Dynamics 365</span></strong></span><span class="md-plain"> form. The analyst logged a new bug, included annotations and screenshots and the </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool output. A developer can be assigned, pick this up and begin working on the bug. By having the </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool output the developer can now </span><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">see each call made and review the Attributions within the respective KPI.</span></u></span></strong></span><span class="md-plain"> For more information, refer to the </span><span class="md-pair-s "><strong><em><span class="md-plain">Attribution</span></em></strong></span><span class="md-plain"> section within </span><span class="md-meta-i-c md-link"><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-model-driven-apps---monitor-tool-part-1-messages-and-scenarios" rel="noopener noreferrer" target="_blank"><span class="md-plain">Part 1</span></a></span><span class="md-plain">.</span></p>
<p class="md-end-block md-p" style="padding-left: 330px;"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/SaveForm.Attribution.OnSaveFollowedByOnTabChanged.PNG"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/d90ba68e_2D00_f094_2D00_4706_2D00_a4c1_2D00_31b065ffa8c0-245500-complete/pastedimage1597357184200v5.png" /></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain">Storing Monitoring Sessions</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">The </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool output comes in two flavors: CSV and JSON. Both make for light weight storage and are fairly easy to parse as shown later. These files can be attached to emails or stored in a shared location like a network drive.</span></p>
<h3 class="md-end-block md-heading"><span class="md-plain">Power BI and CSV Files</span></h3>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">The csv files downloaded from the </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool can be added </span><span class="md-pair-s "><strong><span class="md-plain">Azure Blob Storage</span></strong></span><span class="md-plain"> or stored locally and displayed in a </span><span class="md-pair-s "><strong><span class="md-plain">Power BI Dashboard</span></strong></span><span class="md-plain">. This allows for analysts and support teams to drill down into sessions to gain further insights. The csv files can work both locally with </span><span class="md-pair-s "><strong><span class="md-plain">Power BI Desktop</span></strong></span><span class="md-plain"> and online. The below image shows a sample taken from a </span><span class="md-pair-s "><strong><span class="md-plain">Canvas App Monitor Session</span></strong></span><span class="md-plain">. Additional information and samples can be found in </span><span class="md-meta-i-c  md-link"><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-canvas-driven-apps---the-monitoring-tool" rel="noopener noreferrer" target="_blank"><span class="md-plain">the "</span><span class="md-pair-s "><strong><span class="md-plain">Canvas Driven Apps - The Monitoring Tool</span></strong></span><span class="md-plain">" article.</span></a></span></p>
<p class="md-end-block md-p" style="padding-left: 300px;"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/MonitorTool.PowerBiExample.PNG"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/d90ba68e_2D00_f094_2D00_4706_2D00_a4c1_2D00_31b065ffa8c0-245500-complete/pastedimage1597357184201v6.png" /></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain">Experimenting with Extraction for Analytics</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<h3 class="md-end-block md-heading"><span class="md-plain">Storing outputs in Azure Blob Storage</span></h3>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">During this writing and the writing of the </span><span class="md-meta-i-c  md-link"><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-canvas-driven-apps---the-monitoring-tool" rel="noopener noreferrer" target="_blank"><span class="md-plain">Monitor Tool for Canvas Apps</span></a></span><span class="md-plain">, I began to collect outputs from both and storing within </span><span class="md-pair-s "><strong><span class="md-plain">Azure Blob Storage</span></strong></span><span class="md-plain"> containers. There are multiple reasons why I chose to utilize </span><span class="md-pair-s "><strong><span class="md-plain">Azure Blob Storage</span></strong></span><span class="md-plain">, </span><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">mainly cost</span></u></span></strong></span><span class="md-plain"> but also </span><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">interoperability with other services such as Power BI, Azure Data Lake and Azure Event Grid.</span></u></span></strong></span><span class="md-plain"> </span></p>
<p class="md-end-block md-p"><span class="md-pair-s "><strong><span class="md-plain">Azure Blob Storage</span></strong></span><span class="md-plain"> also integrates very well with both </span><span class="md-pair-s "><strong><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/connectors/azureblob/" rel="noopener noreferrer" target="_blank"><span class="md-plain">Azure Logic Apps</span></a></span></strong></span><span class="md-plain">, </span><span class="md-pair-s "><strong><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-storage-blob-trigger?tabs=csharp" rel="noopener noreferrer" target="_blank"><span class="md-plain">Azure Functions</span></a></span></strong></span><span class="md-plain"> and </span><span class="md-pair-s "><strong><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/connectors/azureblob/" rel="noopener noreferrer" target="_blank"><span class="md-plain">Power Automate Flows</span></a></span></strong></span><span class="md-plain">. Each of these include a triggering mechanism on a new blob added to a container, working as a sort of drop folder. This may the choice to use </span><span class="md-pair-s "><strong><span class="md-plain">Azure Blob Storage</span></strong></span><span class="md-plain"> easy for me but I will also point out that specifically </span><span class="md-pair-s "><strong><span class="md-plain">Power Automate Flows</span></strong></span><span class="md-plain"> also can be triggered from </span><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/connectors/onedrive/" rel="noopener noreferrer" target="_blank"><span class="md-pair-s "><strong><span class="md-plain">OneDrive</span></strong></span></a></span><span class="md-plain"> or </span><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/connectors/sharepointonline/" rel="noopener noreferrer" target="_blank"><span class="md-pair-s "><strong><span class="md-plain">SharePoint</span></strong></span></a></span><span class="md-plain">. This allows Makers to stay within the </span><span class="md-pair-s "><strong><span class="md-plain">Microsoft 365 ecosphere</span></strong></span><span class="md-plain"> and avoid spinning up multiple </span><span class="md-pair-s "><strong><span class="md-plain">Azure</span></strong></span><span class="md-plain"> services if desired.</span></p>
<h3 class="md-end-block md-heading"><span class="md-plain">Extracting to Log Stores</span></h3>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">Extracting the messages with in the </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool to a log store allows for analysts and support teams to parse and query the sessions. Determining how we want to store these messages will determine what services we leverage. </span></p>
<h3 class="md-end-block md-heading"><span class="md-plain">Choosing Azure Application Insights</span></h3>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">If we want </span><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/distributed-tracing" rel="noopener noreferrer" target="_blank"><span class="md-plain">distributed transaction tracing</span></a></span><span class="md-plain"> I'd suggest </span><span class="md-pair-s "><strong><span class="md-plain">Azure Application Insights</span></strong></span><span class="md-plain">. </span><span class="md-pair-s "><strong><span class="md-plain">Application Insights</span></strong></span><span class="md-plain"> will allow for pushing messages to specialized tables that feed dashboards and features native to the service such as End to End Transactions and Exception parsing.</span></p>
<p class="md-end-block md-p"><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">Network messages can be stored in the requests or dependencies tables, which are designed, along with page views, to visual a typical web application's interactions.</span></u></span></strong></span><span class="md-plain"> </span><span class="md-pair-s "><strong><em><span class="md-plain">Fetch</span></em></strong></span><span class="md-plain"> network messages, representing calls to an API, fit nicely into the </span><span class="md-pair-s "><strong><span class="md-plain">requests</span></strong></span><span class="md-plain"> table as shown below:</span></p>
<p class="md-end-block md-p" style="padding-left: 270px;"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/MonitorTool.ApplicationInsights.Requests.PNG"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/d90ba68e_2D00_f094_2D00_4706_2D00_a4c1_2D00_31b065ffa8c0-245500-complete/pastedimage1597357184201v7.png" /></span></p>
<p class="md-end-block md-p"><span class="md-pair-s "><strong><span class="md-plain">Dependencies</span></strong></span><span class="md-plain"> on the other hand can represent dependent web resources.</span></p>
<p class="md-end-block md-p" style="padding-left: 270px;"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/MonitorTool.ApplicationInsights.Dependencies.PNG"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/d90ba68e_2D00_f094_2D00_4706_2D00_a4c1_2D00_31b065ffa8c0-245500-complete/pastedimage1597357184201v8.png" /></span></p>
<h4 class="md-end-block md-heading"><span class="md-plain">Using Azure Function to serve data</span></h4>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-pair-s "><strong><span class="md-plain">Azure Application Insights</span></strong></span><span class="md-plain"> works well with microservices built using </span><span class="md-pair-s "><strong><span class="md-plain">Azure Functions</span></strong></span><span class="md-plain">. A benefit of </span><span class="md-pair-s "><strong><span class="md-plain">Azure Functions</span></strong></span><span class="md-plain"> is the ability to </span><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-storage-blob-trigger?tabs=csharp" rel="noopener noreferrer" target="_blank"><span class="md-plain">have a function fire on create of a blob within a container</span></a></span><span class="md-plain">. For more information and a helpful </span><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-storage-blob-triggered-function" rel="noopener noreferrer" target="_blank"><span class="md-plain">quick start to working with Blob triggered Azure Functions, check out this reference</span></a></span><span class="md-plain">. Below is the method signature of a sample Azure Function:</span></p>
<pre class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><span></span>[embed:dc8ab71f-3b98-42d9-b0f6-e21e02a0f8e2:be9b6974-363e-4f11-9c37-a88a42363db7:type=csharp&text=%5BFunctionName%28%22BlobTriggeredMonitorToolToApplicationInsights%22%29%5D%0D%0Apublic%20void%20Run%28%5BBlobTrigger%28%22powerapps-monitortool-outputs%2F%7Bname%7D%22%2C%20Connection%20%3D%20%22%22%29%5DStream%20myBlob%2C%20string%20name%2C%20ILogger%20log%29]<span></span></pre>
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://github.com/aliyoussefi/MonitoringPowerPlatform/tree/master/Samples/ModelApps/MonitorToolExtractor" rel="noopener noreferrer" target="_blank"><span class="md-plain">In the sample provided</span></a></span><span class="md-plain"> you'll see that the function takes the JSON payload, parses it and determines how to add to </span><span class="md-pair-s "><strong><span class="md-plain">Azure Application Insights</span></strong></span><span class="md-plain">. Depending on the </span><span class="md-pair-s "><strong><em><span class="md-plain">messageCategory</span></em></strong></span><span class="md-plain"> property, it will </span><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">funnel messages to custom events, requests or dependencies.</span></u></span></strong></span></p>
<p class="md-end-block md-p"><span class="md-plain">As always, review the Telemetry Client for ideas and techniques to enrich messages sent to </span><span class="md-pair-s "><strong><span class="md-plain">Azure Application Insights</span></strong></span><span class="md-plain">. Also, if desired, review </span><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/sampling#types-of-sampling" rel="noopener noreferrer" target="_blank"><span class="md-plain">how to Sample messages to reduce noise and keep cost down</span></a></span><span class="md-plain">.</span></p>
<h3 class="md-end-block md-heading"><span class="md-plain">Choosing Azure Log Analytics</span></h3>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-pair-s "><strong><span class="md-plain">Azure Log Analytics</span></strong></span><span class="md-plain"> allow for custom tables that provide the greatest flexibility. The </span><span class="md-pair-s "><strong><span class="md-plain">Data Collector API</span></strong></span><span class="md-plain"> has a native connector to </span><span class="md-pair-s "><strong><span class="md-plain">Power Automate</span></strong></span><span class="md-plain"> that allows Makers to quickly deliver </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> messages with a no or low code solution. Both </span><span class="md-pair-s "><strong><span class="md-plain">Power Automate</span></strong></span><span class="md-plain"> and </span><span class="md-pair-s "><strong><span class="md-plain">Azure Logic Apps</span></strong></span><span class="md-plain"> both offer triggers on create of a blob providing flexibility on which service to choose. </span></p>
<h4 class="md-end-block md-heading"><span class="md-plain">Using Power Automate to serve data</span></h4>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">To work with </span><span class="md-pair-s "><strong><span class="md-plain">Power Automate</span></strong></span><span class="md-plain">, begin by creating a new </span><span class="md-pair-s "><strong><span class="md-plain">Power Automate</span></strong></span><span class="md-plain"> flow. Set the trigger type to use the </span><span class="md-pair-s "><strong><span class="md-plain">Azure Blob Storage</span></strong></span><span class="md-plain"> trigger action "</span><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/connectors/azureblob/#when-a-blob-is-added-or-modified-(properties-only)" rel="noopener noreferrer" target="_blank"><span class="md-plain">When a blob is added or modified</span></a></span><span class="md-plain">". If a connection hasn't been established, create a connection. Once created locate the blob container to monitor. This container will be our drop folder. </span></p>
<p class="md-end-block md-p"><span class="md-plain">The trigger is only designed to tell us a new blob is available, so the next step is to get the blob content. Using the </span><span class="md-pair-s "><strong><em><span class="md-plain">FileLocator</span></em></strong></span><span class="md-plain"> property we can now get the serialized messages and session information and deliver to </span><span class="md-pair-s "><strong><span class="md-plain">Log Analytics</span></strong></span><span class="md-plain">. </span></p>
<p class="md-end-block md-p"><span class="md-plain">Within </span><span class="md-pair-s "><strong><span class="md-plain">Power Automate</span></strong></span><span class="md-plain">, search for the "</span><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/connectors/azureloganalyticsdatacollector/#send-data" rel="noopener noreferrer" target="_blank"><span class="md-plain">Send Data</span></a></span><span class="md-plain">" action. Set the JSON Request body field to be the </span><span class="md-pair-s "><strong><em><span class="md-plain">File Content</span></em></strong></span><span class="md-plain"> value from the "</span><span class="md-meta-i-c  md-link"><a href="https://docs.microsoft.com/en-us/connectors/azureblob/#get-blob-content" rel="noopener noreferrer" target="_blank"><span class="md-plain">Get blob content</span></a></span><span class="md-plain">" action.</span></p>
<p class="md-end-block md-p" style="padding-left: 270px;"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/PowerAutomate.BlobTriggerToLogAnalytics.PNG"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/d90ba68e_2D00_f094_2D00_4706_2D00_a4c1_2D00_31b065ffa8c0-245500-complete/pastedimage1597357184201v9.png" /></span></p>
<p class="md-end-block md-p"><span class="md-plain">The advantage here is </span><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">with three actions and no code written I am able to listen to a drop folder for output files and send to Azure Log Analytics.</span></u></span></strong></span><span class="md-plain"> The native JSON serialization option from the </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool really serves us well here, allowing a seamless insertion into our custom table.</span></p>
<p class="md-end-block md-p" style="padding-left: 270px;"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/MonitorTool.LogAnalytics.PNG"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/d90ba68e_2D00_f094_2D00_4706_2D00_a4c1_2D00_31b065ffa8c0-245500-complete/pastedimage1597357184201v10.png" /></span></p>
<p class="md-end-block md-p"><span class="md-plain">Ideally we would expand the </span><span class="md-pair-s "><strong><span class="md-plain">Power Automate</span></strong></span><span class="md-plain"> flow to parse the JSON and iterate through messages to allow for individual entries into the table.</span></p>
<p class="md-end-block md-p" style="padding-left: 300px;"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/PowerAutomate.BlobTriggerToLogAnalyticsWithLoop.PNG"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/d90ba68e_2D00_f094_2D00_4706_2D00_a4c1_2D00_31b065ffa8c0-245500-complete/pastedimage1597357184202v11.png" /></span></p>
<p class="md-end-block md-p"><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">Just remember the content maybe encoded to "octet-stream" and will need to be converted.</span></u></span></strong></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain">Sample Kusto Queries</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">Below are sample </span><span class="md-pair-s "><strong><span class="md-plain">Kusto</span></strong></span><span class="md-plain"> queries designed for </span><span class="md-pair-s "><strong><span class="md-plain">Azure Application Insights</span></strong></span><span class="md-plain">.</span></p>
<p class="md-end-block md-p"><span class="md-pair-s "><strong><span class="md-plain">General Messages</span></strong></span></p>
<pre class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><span></span>[embed:dc8ab71f-3b98-42d9-b0f6-e21e02a0f8e2:2f829952-db4f-4c32-b991-3907fb168d67:type=text&text=%2F%2FReview%20Performance%20Messages%0D%0AcustomEvents%20%0D%0A%7C%20extend%20cd%3Dparse_json%28customDimensions%29%0D%0A%7C%20where%20cd.messageCategory%20%3D%3D%20%22Performance%22%0D%0A%7C%20project%20session_Id%2C%20name%2C%20cd.dataSource]<span></span></pre>
<p class="md-end-block md-p"><span class="md-pair-s "><strong><span class="md-plain">Browser Requests</span></strong></span></p>
<pre class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><span></span>[embed:dc8ab71f-3b98-42d9-b0f6-e21e02a0f8e2:969898bd-9b1f-4c0f-a1a9-aad159e6b069:type=text&text=%2F%2FRequest%20Method%2C%20ResultCode%2C%20Duration%20and%20Sync%0D%0Arequests%20%0D%0A%7C%20extend%20cd%3Dparse_json%28customDimensions%29%0D%0A%7C%20extend%20data%3Dparse_json%28tostring%28cd.data%29%29%0D%0A%7C%20project%20session_Id%2C%20name%2C%20data.method%2C%20resultCode%2C%20data.name%2C%20data.duration%2C%20data.sync%2C%20cd.fileName]<span></span></pre>
<pre class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><span></span>[embed:dc8ab71f-3b98-42d9-b0f6-e21e02a0f8e2:49d0e06d-306e-49f4-ab72-0c2254cf19c9:type=text&text=%2F%2FRequest%20Method%2C%20ResultCode%2C%20Duration%20and%20Resource%20Timings%0D%0Arequests%20%0D%0A%7C%20extend%20cd%3Dparse_json%28customDimensions%29%0D%0A%7C%20extend%20data%3Dparse_json%28tostring%28cd.data%29%29%0D%0A%7C%20project%20session_Id%2C%20name%2C%20data.method%2C%20resultCode%2C%20data.name%2C%20data.duration%2C%0D%0Adata.startTime%2C%20%0D%0Adata.fetchStart%2C%0D%0Adata.domainLookupStart%2C%0D%0Adata.connectStart%2C%0D%0Adata.requestStart%2C%0D%0Adata.responseStart%2C%0D%0Adata.responseEnd]<span></span></pre>
<p class="md-end-block md-p"><span class="md-plain">Review the </span><span class="md-meta-i-c  md-link"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Resource_Timing_API/Using_the_Resource_Timing_API" rel="noopener noreferrer" target="_blank"><span class="md-plain">documentation on Resource Timings located here</span></a></span><span class="md-plain"> to better understand what these markers are derived from.</span></p>
<p class="md-end-block md-p" style="padding-left: 240px;"><span class="md-image md-img-loaded" data-src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/resource-timing-api.png"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/d90ba68e_2D00_f094_2D00_4706_2D00_a4c1_2D00_31b065ffa8c0-245500-complete/pastedimage1597357184202v12.png" /></span></p>
<p class="md-end-block md-p"><span class="md-pair-s "><strong><span class="md-plain">Key Performance Indicators</span></strong></span></p>
<pre class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><span></span>[embed:dc8ab71f-3b98-42d9-b0f6-e21e02a0f8e2:c25cdcd6-bc9a-411a-a5eb-7e0ce1bf3634:type=text&text=pageViews%20%0D%0A%7C%20extend%20cd%3Dparse_json%28customDimensions%29%0D%0A%7C%20extend%20cm%3Dparse_json%28customMeasurements%29%0D%0A%7C%20extend%20data%3Dparse_json%28tostring%28cd.data%29%29%0D%0A%7C%20extend%20attribution%3Dparse_json%28tostring%28data.Attribution%29%29%0D%0A%7C%20where%20name%3D%3D%22FullLoad%22%0D%0A%7C%20order%20by%20tostring%28data.FirstInteractionTime%29%2C%20toint%28cm.duration%29%0D%0A%7C%20project%20session_Id%2C%20name%2C%20data.FirstInteractionTime%2Ccm.duration%2C%20attribution]<span></span></pre>
<h2 class="md-end-block md-heading"><span class="md-plain">Sample Code</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://github.com/aliyoussefi/MonitoringPowerPlatform/tree/master/Samples/ModelApps/MonitorToolExtractor" rel="noopener noreferrer" target="_blank"><span class="md-plain">Azure Function and Azure Application Insights - Monitor Tool Extractor</span></a></span></p>
<p class="md-end-block md-p"><span class="md-meta-i-c md-link"><a href="https://github.com/aliyoussefi/MonitoringPowerPlatform/blob/master/Samples/PowerAutomate/LogAnalytics/MonitorToolOutputtoLogAnalytics_20200813221745.zip" rel="noopener noreferrer" target="_blank"><span class="md-plain">Power Automate and Azure Log Analytics</span></a></span></p>
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://github.com/aliyoussefi/MonitoringPowerPlatform/tree/master/Samples/AzureFunction/MonitoringWithApplicationInsights" rel="noopener noreferrer" target="_blank"><span class="md-plain">Optional Azure Application Insights Custom Connector</span></a></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain">Next Steps</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">In this article we have covered how to work with the </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool output files. </span><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">Viewing within Power BI Dashboards, attaching to DevOps work items and storing in Azure backed log stores are all possibilities.</span></u></span></strong></span><span class="md-plain"> Included </span><span class="md-meta-i-c  md-link"><a href="https://github.com/aliyoussefi/MonitoringPowerPlatform/tree/master/Samples" rel="noopener noreferrer" target="_blank"><span class="md-plain">sample code</span></a></span><span class="md-plain"> and </span><span class="md-pair-s "><strong><span class="md-plain">Kusto</span></strong></span><span class="md-plain"> queries to help you get started have also been provided.</span></p>
<p class="md-end-block md-p"><span class="md-plain">This article showcases use cases and strategies for working with the </span><span class="md-pair-s "><strong><span class="md-plain">Monitor</span></strong></span><span class="md-plain"> tool but really only represents the tip of the iceberg. Continue collecting, examining and churning the output for deep insight into user and platform trends.</span></p>
<p class="md-end-block md-p"><span class="md-plain">If you are interested in learning more about </span><span class="md-meta-i-c  md-link"><a href="/crm/b/crminthefield/posts/pfe-dynamics-365-service-offerings" rel="noopener noreferrer" target="_blank"><span class="md-pair-s "><strong><span class="md-plain">specialized guidance and training</span></strong></span><span class="md-plain"> for monitoring or other areas of the Power Platform</span></a></span><span class="md-plain">, which includes a </span><span class="md-meta-i-c  md-link"><a href="/cfs-file/__key/communityserver-blogs-components-weblogfiles/00-00-00-17-38/WorkshopPLUS-_2D00_-Dynamics-365-Customer-Engagement-Monitoring-with-Application-lnsights-1-Day-with-Lab_2D00_FA5D599F_2D00_20E4_2D00_4087_2D00_A713_2D00_39FBD14DF7E5.pdf" rel="noopener noreferrer" target="_blank"><span class="md-plain">monitoring workshop</span></a></span><span class="md-plain">, please contact your </span><span class="md-pair-s "><strong><span class="md-plain">Technical Account Manager</span></strong></span><span class="md-plain"> or </span><span class="md-pair-s "><strong><span class="md-plain">Microsoft representative</span></strong></span><span class="md-plain"> for further details. </span></p>
<p class="md-end-block md-p"><span class="md-plain">Your feedback is </span><span class="md-pair-s "><strong><span class="md-pair-s"><u><span class="md-plain">extremely valuable</span></u></span></strong></span><span class="md-plain"> so please leave a comment below and I'll be happy to help where I can! Also, if you find any inconsistencies, omissions or have suggestions, </span><span class="md-meta-i-c  md-link"><a href="https://github.com/aliyoussefi/MonitoringPowerPlatform/issues" rel="noopener noreferrer" target="_blank"><span class="md-plain">please go here to submit a new issue</span></a></span><span class="md-plain">.</span></p>
<h2 class="md-end-block md-heading"><span class="md-plain">Index</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p class="md-end-block md-p md-focus"><span class="md-meta-i-c md-link"><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-introduction" rel="noopener noreferrer" target="_blank"><span class="md-plain">Monitoring the Power Platform: Introduction and Index</span></a></span></p>