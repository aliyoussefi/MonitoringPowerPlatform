<h2 class="md-end-block md-heading"><span class="md-plain">Summary</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p><a href="https://azure.microsoft.com/en-us/overview/what-is-devops/" rel="noopener noreferrer" target="_blank"><span>DevOps</span></a><span> has become more and more ingrained into our </span><strong><span>Power Platform</span></strong><span> project lifecycle. Work item tracking and feedback tools for teamwork. Continuous integration and delivery for code changes and solution deployments. Automated testing for assurance, compliance and governance considerations. Microsoft's tool, </span><strong><a href="https://azure.microsoft.com/en-us/overview/what-is-devops/#culture" rel="noopener noreferrer" target="_blank"><span>Azure DevOps</span></a></strong><span> provides native capabilities to plan, work, collaborate and deliver. Each step along the way in our </span><a href="https://docs.microsoft.com/en-us/power-platform/alm/devops-build-tools" rel="noopener noreferrer" target="_blank"><strong><span>Power Platform DevOps</span></strong><span> journey</span></a><span> can be tracked and monitored which will be the primary objective of this article.</span></p>
<p><span>This article will focus on feedback, specifically from events that happen with </span><strong><span>Azure DevOps</span></strong><span>. We will first look at subscription setup and notifications to team members and interested parties. From there we will dive deeper into feedback events, how they work, how they can be filtered and delivered. Finally we will review a real world example utilizing service hooks, </span><strong><span>Power Automate</span></strong><span> and </span><strong><span>Microsoft Teams</span></strong><span>.</span></p>
<h2><a class="md-header-anchor" name="sources"></a><span>Sources</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p><span>Sources of </span><strong><span>Azure DevOps</span></strong><span> events that impact our delivery can come from virtually any area of the platform including work items, pipelines, source control, testing and artifact delivery. For </span><a href="https://docs.microsoft.com/en-us/azure/devops/notifications/oob-supported-event-types?view=azure-devops" rel="noopener noreferrer" target="_blank"><span>practically any event within </span><strong><span>Azure DevOps</span></strong></a><span>, such as completed work items, executed builds or delivered releases, we can setup notifications. Service hooks and notification subscriptions can be configured to allow real time reporting of events to external parties and systems allowing for us to stay in a state of continuous communication and collaboration.</span></p>
<p><span style="font-size: 150%;"><strong>AUTHOR NOTE: Click on each image to enlarge for detail.</strong></span></p>
<p style="padding-left: 240px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096199v1.png" /></p>
<h2><a class="md-header-anchor" name="subscriptions-and-notifications"></a><span>Subscriptions and Notifications</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p><a href="https://docs.microsoft.com/en-us/azure/devops/notifications/about-notifications?view=azure-devops" rel="noopener noreferrer" target="_blank"><strong><span>Notifications</span></strong></a><span> help team members stay informed about completed events within with </span><strong><span>Azure DevOps</span></strong><span>. These events are similar to service hook events except the </span><strong><span>primary delivery mechanism is through email</span></strong><span>. Notifications are based on subscriptions configured with the notifications section of the Project Settings. If the subscription's filter conditions are met by the event, a notification is generated. </span><strong><span>A notification is generated for every subscription/event match.</span></strong></p>
<h3><a class="md-header-anchor" name="setting-up-subscriptions"></a><span>Setting up Subscriptions</span></h3>
<p><span class="md-plain"></span>&nbsp;</p>
<p><strong><a href="https://docs.microsoft.com/en-us/azure/devops/notifications/manage-organization-notifications?view=azure-devops" rel="noopener noreferrer" target="_blank"><span>Subscriptions</span></a></strong><span> can be used to notify stakeholders and downstream sources of events </span><a href="https://docs.microsoft.com/en-us/azure/devops/notifications/oob-built-in-notifications?view=azure-devops" rel="noopener noreferrer" target="_blank"><span>each time an event occurs</span></a><span>. This allows for team members to </span><strong><span>automatically send notifications while performing day to day tasks</span></strong><span> such as updating work items and checking in changes, </span><strong><span>without manual intervention</span></strong><span>. Below is an example of setting up a new subscription for work items.</span></p>
<p style="padding-left: 270px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096200v2.jpeg" /></p>
<p><span>Once configured, we can now </span><strong><span>notify the team based on any work item field such as Iteration or Area Path</span></strong><span>. The below image shows filtering to the </span><em><span>University Support Team</span></em><span> </span><strong><span>Area Path</span></strong><span>. This subscription will </span><strong><span>send an email once any work item is closed</span></strong><span> by the team.</span></p>
<p style="padding-left: 270px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096200v3.png" /></p>
<p><a href="https://docs.microsoft.com/en-us/azure/devops/notifications/concepts-events-and-notifications?view=azure-devops" rel="noopener noreferrer" target="_blank"><strong><span>Subscriptions</span></strong></a><span> can also be used for updates to the code base, helpful for when we need to </span><strong><span>track changes and requests for peer reviews</span></strong><span>. If Git is used for source control management, </span><strong><u><span>each commit and pull request can be subscribed to.</span></u></strong></p>
<p style="padding-left: 270px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096201v4.jpeg" /></p>
<p><strong><span>Builds and Releases</span></strong><span> can also be setup to deliver notifications based on their lifecycle events. For builds, subscriptions can be based on build completions or when they fail.</span></p>
<p style="padding-left: 270px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096201v5.jpeg" /></p>
<p><span><strong>Releases</strong> can notify stakeholders on completion, on pending approvals and when manual intervention is needed.</span></p>
<p style="padding-left: 270px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096201v6.jpeg" /></p>
<p><span>Example email of a </span><strong><span>pending deployment approval</span></strong><span>:</span></p>
<p style="padding-left: 270px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096201v7.jpeg" /></p>
<p><span>Each notification can be scoped to a particular role or stakeholder which can help control clutter. The below image shows how the "</span><strong><em><span>Deliver to</span></em></strong><span>" field can be fine tuned to team or project members or even custom email addresses distribution lists. </span></p>
<p style="padding-left: 240px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096201v8.jpeg" /></p>
<p><span>The final option is to use SOAP to deliver these same messages via an API call. I haven't used this particular feature and I would recommend if interested in API integration to continue reading. </span><strong><u><span>Below we will cover using Service Hooks for notifications.</span></u></strong><span> </span></p>
<h4><a class="md-header-anchor" name="how-are-recipients-determined"></a><span>How are recipients determined?</span></h4>
<p><span class="md-plain"></span>&nbsp;</p>
<p><a href="https://docs.microsoft.com/en-us/azure/devops/notifications/concepts-email-recipients?view=azure-devops" rel="noopener noreferrer" target="_blank"><span>Email notifications can be scoped to custom personal addresses, teams and groups</span></a><span>. As the initiator of a particular event, you can void being sent a notification by checking the "</span><strong><em><span>Skip initiator</span></em></strong><span>" option. I would set this option for items like work items but consider leaving on for pull requests or builds.</span></p>
<h2><a class="md-header-anchor" name="service-hooks"></a><span>Service Hooks</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p><a href="https://docs.microsoft.com/en-us/azure/devops/service-hooks/overview?view=azure-devops" rel="noopener noreferrer" target="_blank"><strong><span>Service Hooks</span></strong></a><span> are a great way of staying informed and informing others of events happening within </span><strong><span>Azure DevOps</span></strong><span> allowing you to be freed up to focus on other things. Examples include </span><strong><span>pushing notifications to your teams' mobile devices</span></strong><span>, </span><strong><span>notifying team members on Microsoft Teams</span></strong><span> or even </span><strong><span>invoking Microsoft Power Automate flows</span></strong><span>. Services can include other build and release platforms (i.e. Jenkins and Slack), Collaboration tools like </span><strong><span>Office 365</span></strong><span>, Customer Support interfaces like </span><strong><span>UserVoice</span></strong><span> and Integration services (</span><strong><span>Azure Service Bus, Azure Storage, Zapier</span></strong><span>, etc). </span></p>
<p style="padding-left: 270px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500/pastedimage1598619096202v9.png" /></p>
<p><span>When an </span><strong><span>event</span></strong><span> occurs in </span><strong><span>Azure DevOps Services or TFS</span></strong><span>, its content is compared with every </span><strong><span>subscription</span></strong><span> of that event type. If the subscription's filter conditions are met by the event, a notification is generated. </span><strong><span>A notification is generated for every subscription/event match.</span></strong><span> In the example below, the service hook is configured to send a consumer the "</span><strong><em><span>Build Completed</span></em></strong><span>" event.</span></p>
<p style="padding-left: 300px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096202v10.jpeg" /></p>
<p><span>Release events are also available, allowing teams to track when a deployment starts and when each deployment stage state has changed. <a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-azure-devops---orchestrating-deployments-and-automating-release-notes" rel="noopener noreferrer" target="_blank">In a following article</a>, we will discuss the importance of deployment stages can be for collaboration across multiple teams during a deployment. Below is an example of the "</span><strong><em><span>Release deployment started</span></em></strong><span>" trigger.</span></p>
<p style="padding-left: 300px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096202v11.jpeg" /></p>
<p><span>An example of the "</span><strong><em><span>Run Stage State Changed</span></em></strong><span>" trigger.</span></p>
<p style="padding-left: 270px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096202v12.jpeg" /></p>
<h3><a class="md-header-anchor" name="filtering-for-specific-events"></a><span>Filtering for Specific Events</span></h3>
<p><span class="md-plain"></span>&nbsp;</p>
<p><span>Filters include the ability to scope to a particular type of event, for instance consider the build completed event. This can be filtered a specific pipeline for unpacking and committing </span><strong><span>Power Apps</span></strong><span> solutions to source. If successful we may not necessary care but on a failure we want to understand and automate a potential fix. By filtering on the Failed status of our </span><strong><span>Power Apps</span></strong><span> solution pipeline we can send these events to 3rd party communication systems or messaging systems like </span><strong><span>Azure Service Bus</span></strong><span>.</span></p>
<h4><a class="md-header-anchor" name="example-azure-service-bus-messages-for-release-start-and-completion"></a><span>Example: Azure Service Bus Messages for Release Start and Completion</span></h4>
<p><span class="md-plain"></span>&nbsp;</p>
<p><span>Here's an example of </span><strong><span>Azure Service Bus</span></strong><span> and the different locations events can be sent to such as </span><strong><span>Notification Hub, Queues and Topics</span></strong><span>. Each event type such as sending failed events can be sent to queues and topics allowing for integrations between external systems.</span></p>
<p style="padding-left: 270px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096202v13.jpeg" /></p>
<p><span>Once configured, the service hook will deliver a message to the </span><strong><span>Azure Service Bus queue</span></strong><span> based on the filtered event. The below images show an example of messages from a release pipeline start taken using </span><a href="https://github.com/paolosalvatori/ServiceBusExplorer" rel="noopener noreferrer" target="_blank"><span>Azure Service Bus Explorer</span></a><span>. </span><strong><em><span>NOTE: Since writing this, the </span><a href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/explorer" rel="noopener noreferrer" target="_blank"><span>Azure Portal has a new feature</span></a><span> to allow for peeking into queue messages.</span></em></strong></p>
<p style="padding-left: 270px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096203v14.png" /></p>
<p><span>Notice the event type "</span><strong><em><span>ms.vss-release.deplyment-started-event</span></em></strong><span>" signaling the start of the release.</span></p>
<p style="padding-left: 300px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096203v15.jpeg" /></p>
<p><span> For completed releases, the event type "</span><strong><em><span>ms.vss-release.deplyment-completed-event</span></em></strong><span>" will be shown:</span></p>
<p style="padding-left: 300px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096203v16.jpeg" /></p>
<p><span>As highlighted above, the </span><strong><em><span>EventType</span></em></strong><span> field contains what event happened and can help identify and differentiate between events. Included in the release is a markdown message that can be used as part of our release notes. The </span><strong><em><span>createdDate</span></em></strong><span> for both can help determine the length of the deployment of our </span><strong><span>Power Platform</span></strong><span> artifacts.</span></p>
<p style="padding-left: 60px;"><img height="272" src="/cfs-file/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096203v17.gif" width="737" /></p>
<h3><a class="md-header-anchor" name="considerations-for-service-hooks"></a><span>Considerations for Service Hooks</span></h3>
<p><span class="md-plain"></span>&nbsp;</p>
<p><strong><span>Service Hooks</span></strong><span>, like all services within </span><strong><span>Azure DevOps</span></strong><span> can be altered </span><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-azure-devops---using-the-rest-api-to-monitor-pipelines" rel="noopener noreferrer" target="_blank"><span>using the </span><strong><span>Azure DevOps REST API</span></strong></a><span>. </span><a href="https://docs.microsoft.com/en-us/rest/api/azure/devops/hooks/notifications/create?view=azure-devops-rest-5.1" rel="noopener noreferrer" target="_blank"><span>The ability to test notifications</span></a><span> will be helpful as you explore how events are triggers and the payload associated with each event.</span></p>
<h2><a class="md-header-anchor" name="web-hooks"></a><span>Web Hooks</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p><strong><span>Web Hooks</span></strong><span>, used by Service Hooks, allow for publishing messages and events to any type of service interested in the </span><strong><span>Power Apps</span></strong><span> DevOps process. </span><strong><span>Azure DevOps</span></strong><span> provides the ability to integrate with a </span><a href="https://docs.microsoft.com/en-us/azure/devops/service-hooks/services/webhooks?view=azure-devops" rel="noopener noreferrer" target="_blank"><span>generic web hook</span></a><span> that may not be available in the </span><strong><span>Visual Studio Marketplace</span></strong><span>. Web Hooks can be used to deliver messages to low code solutions such as </span><strong><span>Power Automate</span></strong><span> or </span><strong><span>Azure Logic Apps</span></strong><span>. They can also be used for development platforms such as </span><strong><span>Azure Functions</span></strong><span>, </span><a href="https://github.com/aliyoussefi/MonitoringPowerPlatform/tree/master/Samples/DevOps/ReleaseNotesGenerator" rel="noopener noreferrer" target="_blank"><span>allowing for usage of the Azure DevOps SDK</span></a><span> as well as other toolkits and frameworks.</span></p>
<h3><a class="md-header-anchor" name="creating-a-web-hook"></a><span>Creating a Web Hook</span></h3>
<p><span class="md-plain"></span>&nbsp;</p>
<p><span>Creating a web hook requires a subscription for events to be sent to as shown in the diagram above. Messages can be consumed by listeners interested in a particular event or topic. This architectural pattern known as Publish and Subscribe (Pub/Sub) allows </span><strong><span>Azure DevOps</span></strong><span> to publish many types of messages and for subscribers to only be notified of events they are concerned about.</span></p>
<p style="padding-left: 300px;"><img src="/resized-image/__size/320x240/__key/communityserver-components-multipleuploadfilemanager/8c506089_2D00_7eea_2D00_4fa3_2D00_b364_2D00_43c54e96c007-245500-complete/pastedimage1598619096203v18.jpeg" /></p>
<h3><a class="md-header-anchor" name="example-web-hooks-in-action"></a><span>Example: Web Hooks in Action</span></h3>
<p><span class="md-plain"></span>&nbsp;</p>
<p><span>A real world example of using a web hook came up when I needed a solution for creating a notification that a build pipeline was started to migrate a </span><strong><span>Dynamics 365</span></strong><span> solution to another environment for testing. Typically, I would first look to notifications as detailed above. However in this particular scenario, I needed to provide additional detail from other platforms that are used for work item tracking outside of </span><strong><span>Azure DevOps</span></strong><span>. The solution needed to provide an update to the development team that their work was being promoted and the ability to track the work items.</span></p>
<p><span>In this scenario, the solution I settled on four services: </span><strong><span>Azure DevOps Web Hooks</span></strong><span>, </span><strong><span>Power Automate Flows</span></strong><span>, </span><strong><a href="https://adaptivecards.io/" rel="noopener noreferrer" target="_blank"><span>Microsoft Adaptive Cards</span></a></strong><span> and </span><strong><span>Microsoft Teams</span></strong><span>. </span><strong><span>Azure DevOps Web Hooks</span></strong><span> were used to fire an event to </span><strong><span>Power Automate,</span></strong><span> which was listening for an HTTP request. </span><strong><span>Power Automate</span></strong><span> would then query the 3rd party work item tracking service for detailed on work items. From there, </span><strong><span>Power Automate</span></strong><span> would create an </span><strong><span>Adaptive Card</span></strong><span>. The </span><strong><span>Adaptive Card</span></strong><span> was designed to provide direct links back to the 3rd part work item service and to the </span><strong><span>Azure DevOps Build</span></strong><span>, currently in progress. Finally, the </span><strong><span>Adaptive Card</span></strong><span> was sent to a </span><strong><span>Microsoft Teams Channel</span></strong><span> for distribution.</span></p>
<p></p>
<p style="padding-left: 60px;"><span><img alt="" height="272" src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/DevOps/WebHookToTeamsAdaptiveCard.gif" width="736" /></span></p>
<p><span>For sample code and further documentation, please </span><a href="https://github.com/aliyoussefi/MonitoringPowerPlatform/tree/master/Samples/DevOps/PowerAutomate" rel="noopener noreferrer" target="_blank"><span>refer to this link</span></a><span>.</span></p>
<h2><a class="md-header-anchor" name="next-steps"></a><span>Next Steps</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p><span>In this article we have the beginning stages of collecting and distributing feedback for our teams and stakeholders. Email notifications based on work item updates and code changes allow specific teams to quickly respond to changes. Service hooks allow for events to be sent to first and third party integrations. Web hooks allow for complete flexibility, delivering stateful messages to HTTP endpoint subscribers.</span></p>
<p><span>Continuing from here, </span><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-azure-devops---using-the-rest-api-to-monitor-pipelines" rel="noopener noreferrer" target="_blank"><span>we will explore the Azure DevOps REST API and specific actions that can be useful for tracking changes</span></a><span>. </span><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-azure-devops---orchestrating-deployments-and-automating-release-notes" rel="noopener noreferrer" target="_blank"><span>For collaboration, we will review Chat Bots and integrations with Microsoft Teams</span></a><span>. For deployment tracking, we will dive into build and release events and opportunities to analyze for greater insights into trends.</span></p>
<p><span>If you are interested in learning more about </span><a href="/crm/b/crminthefield/posts/pfe-dynamics-365-service-offerings" rel="noopener noreferrer" target="_blank"><strong><span>specialized guidance and training</span></strong><span> for monitoring or other areas of the Power Platform</span></a><span>, which includes a </span><a href="/cfs-file/__key/communityserver-blogs-components-weblogfiles/00-00-00-17-38/WorkshopPLUS-_2D00_-Dynamics-365-Customer-Engagement-Monitoring-with-Application-lnsights-1-Day-with-Lab_2D00_FA5D599F_2D00_20E4_2D00_4087_2D00_A713_2D00_39FBD14DF7E5.pdf" rel="noopener noreferrer" target="_blank"><span>monitoring workshop</span></a><span>, please contact your </span><strong><span>Technical Account Manager</span></strong><span> or </span><strong><span>Microsoft representative</span></strong><span> for further details. </span></p>
<p><span>Your feedback is </span><strong><u><span>extremely valuable</span></u></strong><span> so please leave a comment below and I'll be happy to help where I can! Also, if you find any inconsistencies, omissions or have suggestions, </span><a href="https://github.com/aliyoussefi/MonitoringPowerPlatform/issues" rel="noopener noreferrer" target="_blank"><span>please go here to submit a new issue</span></a><span>.</span></p>
<h2><a class="md-header-anchor" name="index"></a><span>Index</span></h2>
<p><span class="md-plain"></span>&nbsp;</p>
<p><a href="/crm/b/crminthefield/posts/monitoring-the-power-platform-introduction" rel="noopener noreferrer" target="_blank"><span>Monitoring the Power Platform: Introduction and Index</span></a></p>