# Delivering Insights and Events from Azure DevOps for PowerApps

## Overview

Placeholder

https://docs.microsoft.com/en-us/azure/devops/notifications/concepts-events-and-notifications?view=azure-devops

## Sources

Build Pipeline Tasks

​	Tasks

​	Artifacts

Release Pipeline Tasks

​	Tasks

​		Azure Service Bus

​		Application Insights Release Annotations

​	Service Hooks

​		Web Hooks

​		Chat Integrations

Web Hooks and Notification Settings

## Build Pipeline

Build Pipeline has capabilities to review analytics from an API. This allows us to request for each build not only the logs and timings but how the build compares to previous builds. From this we can conclude if our builds are trending in the right direction and if not, what can we do to course correct. 

## Release Pipelines
### Quality Gates
https://docs.microsoft.com/en-us/azure/devops/pipelines/release/approvals/gates?view=azure-devops&viewFallbackFrom=vsts

Quality Gates allow for numerous ways to integrate monitoring into Azure DevOps. Each deployment include pre and post conditions which can be leveraged to send events and metrics. For instance, the Azure Function gate can be used to invoke a micro service that writes to App Insights, creates ServiceNow tickets or even Kafka events. The possibilities are endless, imagine sending messages back to the Power Platform for each stage of a deployment!

### Tasks

As with Build Pipelines we can send HTTP requests which allow integrations to hundreds of endpoints using the platform of your choosing. If you're a designer perhaps you use Logic Apps with a HTTP trigger to broadcast event information. If you're more of a pro dev you may leverage PowerShell, Service Fabric, etc for more complex scenarios. This also opens us up to Bot or chat capabilities which i'll elaborate on a bit later.

#### Azure Application Insights Release Annotations

The Azure Application Insights Release Annotations task is a marketplace extension from Microsoft allowing a release pipeline to signal an event in a release pipeline. An event could be the start of the pipeline, the end, or any event we are interested in. From here we can use native functionality of Application Insights to stream metrics and logs.

### Service Hooks

One key feature of Azure DevOps is the inclusion of Service Hooks.

## Web Hooks

![](https://docs.microsoft.com/en-us/azure/devops/service-hooks/_img/service-hooks.png?view=azure-devops)

Web Hooks allow for publishing messages and events to any type of service interested in the PowerApps DevOps process. Services can include other build and release platforms (i.e. Jenkins and Slack), Collaboration tools like Office 365, Customer Support interfaces like UserVoice and Integration services (Azure Service Bus, Azure Storage, Zapier, etc). Azure DevOps also provides the ability to integrate with a generic web hook that may not be available in the Visual Studio Marketplace. This is useful for custom connectors used in Microsoft Power Automate, Azure API Management, etc.

https://docs.microsoft.com/en-us/azure/devops/service-hooks/overview?view=azure-devops

#### Creating a Web Hook

Creating a web hook requires a subscription for events to be sent to as shown in the diagram above. Messages can be consumed by listeners interested in a particular event or topic. This architectural pattern known as Publish and Subscribe (Pub/Sub) allows DevOps to publish many types of messages and for subscribers to only be notified of events they are concerned about.

When creating the subscription, there are a couple of things to keep in mind. First only project administrators will have access to edit and view subscriptions by default. This can be adjusted to grant privileges  to other users. Also, specific actions may be limited depending on which event type is chosen.[Create a service hooks subscription](https://docs.microsoft.com/en-us/azure/devops/service-hooks/create-subscription?view=azure-devops) programmatically.

## Notifications

Create https://docs.microsoft.com/en-us/rest/api/azure/devops/hooks/notifications/create?view=azure-devops-rest-5.1

When an **event** occurs in Azure DevOps Services or TFS, its content is compared with every **subscription** of that event type. If the subscription's filter conditions are met by the event, a notification is generated. **A notification is generated for every subscription/event match.**

## Supported Event Types for PowerApps Tasks

https://docs.microsoft.com/en-us/azure/devops/notifications/oob-supported-event-types?view=azure-devops

Build Statuses

Code Pushes

Work Item updates

Release Approvals and Deployments