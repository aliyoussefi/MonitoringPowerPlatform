# Monitoring the Power Platform: Canvas Apps - Auditing and Activity Logs Part 2

## Summary

**Microsoft Power Apps Canvas Apps** provide users the ability to quickly create and publish applications to their enterprise. With this ability comes concerns with governance to ensure users are allowed the appropriate permissions as well as identifying and highlighting specific apps across the organization.

This article will build off of Canvas Apps - Auditing and Activity Part 2 to examine how to search and store audit and activity logs for Canvas Apps.

## Searching the Unified Audit Log

Searching the Unified Audit Log can be performed manually but the log can also be search with automation. Manually there is a portal called the Office 365 Security and Compliance Center Portal that provides a centralized area for auditing all Office 365 services including the Power Platform. If automation is desired the Unified Audit Log offers both a PowerShell module and an API which can be subscribed to. This section covers all three of these in detail. 

## The Office 365 Security and Compliance Center Portal

### Accessing the Office 365 Audit Repots

<u>NOTE: Be mindful of the [permissions](https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/permissions-in-the-security-and-compliance-center?view=o365-worldwide) and licenses needed to use this feature.</u> 

Users will need to be an Office 365 Global Administrator or be a member of one or more Security and Compliance Center role groups. [To provide a user access to the Security and Compliance Center](https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/grant-access-to-the-security-and-compliance-center?view=o365-worldwide), use the Office 365 Admin Center and open the Admin center for Compliance. Alternatively, you can directly access the permissions page from [here](https://protection.office.com/permissions). The permission needed is "**View-Only Audit Logs**" or "**Audit Logs**" which allows for viewing and exporting of audit reports.

### Navigating the Office 365 Compliance Center Portal

The Office 365 Security and Compliance Center found at https://protection.office.com can be used by security analysts to manually search for specific events using a portal user interface. 

![](https://docs.microsoft.com/en-us/power-platform/admin/media/audit-log-search-pa.png)

As shown in the image above, a single action or multiple activities for Canvas App can be chosen for analysis. To begin our search, [run an audit log search](https://docs.microsoft.com/en-us/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance?view=o365-worldwide#search-the-audit-log) by specifying the activities, the time range and optional search parameters such as users or site. Once the search is complete, [review the results](https://docs.microsoft.com/en-us/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance?view=o365-worldwide#step-2-view-the-search-results) in the portal. The results are maxed out at the most 5000 newest events and are incremented 150 records at a time. 

### PowerShell

For PowerShell the ***Search-UnifiedAuditLog***, part of the **MSOline** module, is used for **Office 365** services including **Power Apps Canvas and Model Driven Apps**. For **Canvas Apps** there exist a record type called "**PowerAppsApp**" that will scope to only logs from **Canvas Apps**. Using the same table above, here are the PowerShell Operation equivalents to each captured event:

| Event                  | PowerShell Operation      |
| :--------------------- | :------------------------ |
| Created app            | CreatePowerApp            |
| Launched app           | LaunchPowerApp            |
| Marked app as Featured | MarkPowerAppAsFeatured    |
| Restored app version   | PromotePowerAppVersion    |
| Edited app             | UpdatePowerApp            |
| Published app          | PublishPowerApp           |
| Edited app permission  | PowerAppPermissionEdited  |
| Deleted app            | DeletePowerApp            |
| Marked app as Hero     | MarkPowerAppAsHero        |
| Deleted app permission | PowerAppPermissionDeleted |

```
$endDate = Get-Date
$startDate = $endDate.AddDays(-7) #Search last 7 days
Search-UnifiedAuditLog -StartDate $startDate -EndDate $endDate -RecordType PowerAppsApp
```

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/CanvasApps/UnifiedAuditLog-Examples.JPG)

Depending on what type of audit record you're looking for, the search can be filtered using the Operation argument.

Example of searching for Canvas App creation events:

```
Search-UnifiedAuditLog -StartDate $startDate -EndDate $endDate -RecordType PowerAppsApp -Operation "CreatePowerApp"
```

Example of searching for Canvas App launch events:

```
Search-UnifiedAuditLog -StartDate $startDate -EndDate $endDate -RecordType PowerAppsApp -Operation "LaunchPowerApp"
```

Each record returned includes the data of the audit, the user and the data collected within the ***AuditData*** property. The **app and environment properties** are available within this property which can be **extracted and stored for contextual information to a log data store**.

### Office 365 Management Activity API

Another way to automate delivery of audit data is by use of the **Office 365 Management Activity API**. A really great article by ... covers how to setup a subscription and webhook to deliver to Cosmos DB. 

## Advanced Audit in Microsoft 365

A recent addition to the compliance tooling within Office 365 is the Advanced Audit feature. Currently I do not see anything specific to the Power Platform but this may change in the future. The key call out I see from the documentation is the ability to retain audit logs from one year and the high bandwidth accessibility for the **Office 365 Management Activity API**.

## Next Steps

In this article we have covered getting started with the **Power App Administration PowerShell** module and cmdlets for **Featured and Hero App promotion**. Continue exploring the capabilities of this module as it pertains to your **Power Apps Canvas App** administrative operations. 

We have also covered the **Unified Audit Logs** and what activities are currently captured for **Power Apps Canvas Apps**. Discussed were techniques to view the audit logs within the **Office 365 Security and Compliance Portal** as well as automated techniques using subscriptions and webhooks as well as **automating PowerShell using Azure Automation**. <u>Consider the combination of using the **Unified Audit Log** to notify of events happening and the **Power App Administration** cmdlets to apply security and enrich audits from the audit log.</u>

This article is designed to supplement the article on **Power App Analytics**, which provides more of an all up view of Canvas App usage. Combining these two documents, an administrator can now <u>track analytic metrics as well as the events that define those metrics</u>.

If you are interested in learning more about [**specialized guidance and training** for monitoring or other areas of the Power Platform](https://community.dynamics.com/crm/b/crminthefield/posts/pfe-dynamics-365-service-offerings), which includes a [monitoring workshop](https://community.dynamics.com/cfs-file/__key/communityserver-blogs-components-weblogfiles/00-00-00-17-38/WorkshopPLUS-_2D00_-Dynamics-365-Customer-Engagement-Monitoring-with-Application-lnsights-1-Day-with-Lab_2D00_FA5D599F_2D00_20E4_2D00_4087_2D00_A713_2D00_39FBD14DF7E5.pdf), please contact your **Technical Account Manager** or **Microsoft representative** for further details. 

Your feedback is **<u>extremely valuable</u>** so please leave a comment below and I'll be happy to help where I can! Also, if you find any inconsistencies, omissions or have suggestions, [please go here to submit a new issue](https://github.com/aliyoussefi/MonitoringPowerPlatform/issues).

## Index

[Monitoring the Power Platform: Introduction and Index](