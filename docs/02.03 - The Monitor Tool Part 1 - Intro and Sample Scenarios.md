# Monitoring the Power Platform: Model Driven Apps - Performance and Monitoring Markers

## Summary

The idea of monitoring Dynamics 365 or Model Driven Applications is not a new concept. Understanding where services are failing, users are running into errors, where form and business processes could be tuned for performance are key drivers for most if not all businesses, from small companies to enterprises. Luckily, the Dynamics 365 platform provides many tools to help audit and monitor business and operational events.

This article will cover locating and downloading environment analytics using the Common Data Service for Analytics. Questions regarding capacity and all up usage can be answered here. For operational events the Release Wave 1 2020 for Power Apps will be explored for feature announcement to allow for both manual and automated gathering. For specific activities or workloads within the platform we will explore tools to capture and explain performance markers.

## Collecting User Interface Events

Before we discuss techniques on how to capture events in Dynamics 365 let's examine some meaningful events. From the client perspective this may include performance counters and metrics, user click events and navigation as well as geolocations and preferences of users. 

Some features of the platform allow for collecting markers while other events of interest we will have to supplement with custom delivery mechanisms. The next section of this article will detail a powerful tool that can be leveraged to collect metrics for the Dynamics 365 platform, the Performance Center.

### Performance Center

Refer to the article, Model Driven Apps - Performance Center Overview for getting started and detailed information. 

<show export as json image>

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/PerfCenter/ExportAsJson.PNG" style="zoom: 80%;" />

In the above image, the Export button, located in the upper right hand corner will deliver the work block payload for further examination. Begin by choosing the work block to investigate, in the example above "EditForm" represents an entity record form open. Clicking the JSON or CSV button will produce an output which can then be saved as the desired file type.

### The Monitoring Tool

The Monitoring Tool can be launched from the Power Apps Maker Portal. Once launched, the Play Model Driven App button can be pressed to begin a session attached to the tool.

<insert play button>

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/PlayModelDrivenApp.PNG" style="zoom: 80%;" />

The monitoring tool can also be started by adding “**&monitor=true**” to the URL of your Model Driven Application.

After consenting or allowing to start a session, the Monitoring Tool will light up rapidly with various messages. Similar to the <insert canvas app monitor link> article, each row can be further drilled into for investigation.

<show drilled image - Full Load>

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/RowDetailFullLoad.PNG" style="zoom: 80%;" />

Jesse Parsons' article on the Monitoring Tool, titled '' provides a through deep dive into the Monitoring Tool. I highly suggest reviewing and keeping close by for reference.

## Key Performance Indicators

Key Performance Indicators represent major lifecycle events within a particular user action, such as loading a form. Consider the image below.

<insert monitor tool KPI image>

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/FormLoad-KPIs.PNG" style="zoom: 80%;" />

By sorting the records on "KPI", these events begin to emerge. The image below shows the major lifecycle events or KPIs for a standard form load within Dynamics 365. Beginning with PageNavigationStart and ending with RenderedEditReady, these events represent the completion of a Key Performance Indicator.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/KPI-HighLevel.PNG" style="zoom: 80%;" />

### Scenario: Determining a Form's Load Impact

Consider the scenario of a user logging into the system and opening a lead form for the first time. When performing this action the form and data have not had a chance to be cached or stored locally which results in all items needed to be downloaded. This is sometimes referenced as a cold load. Reviewing the timeline event "**FullLoad**" we can determine what type of load the form rendered as.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-FormLoad-ColdLoad-JSON.JPG)

Now, once captured, the user opens the fly out window to choose another lead record but using the same form. Again using the "**FullLoad**" KPI timeline event we can see the ***LoadType*** is now **two**.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-FormLoad-WarmLoad-JSON.JPG)

Finally, imagine the user needs to navigate back to the original lead record opened on the same form. We can see now the ***LoadType*** is now **three**. Comparing this to the ***LoadType*** 0 image above, the **entityId** is the same.

Here is a sample scenario in full showing the differences in loading new and existing records and how changing a form can impact network requests to the server.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/FullLoad-LoadTypeAndMetadataNetworkRequestExample.gif" style="zoom: 80%;" />

## Attribution

On certain **Key Performance Indicators** a property is included called "***Attribution***". This includes the commands or actions included within a KPI.

<insert Attribution image>

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/FullLoad.Attrition.PNG" style="zoom: 80%;" />

The image above shows for the ***FullLoad*** KPI. Compare that image with the one below.

<insert Attribution image2>

A scenario came up during an investigation into the an increased duration of the FormSave KPI. Upon review, you can see additional events occurred, *tabstatechanged* and *onsave*. The onsave was expected due to the registered event handler on the form. However the tabstatechange was not, this was found to be due to a recent code addition that triggered the setDisplayState of the tab. By reviewing the Attribution property we were able to identify what caused the increase of 5 seconds.

<insert 5 second tabstatechange>

### Timeline Events and Messages

Timeline events represent the flow of the work block captured.





![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-FormLoad-HotLoad-JSON.JPG)

Comparing the cold load versus the cached form and data load:

<img src="https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-Compare-ColdLoad-WarmLoad-KPI.JPG" style="zoom:70%;" />

### Scenario: Locating and Evaluating Synchronous Resource Timings

Requests from a Model Driven App represent outgoing calls from the client to another source. These calls can occur either synchronously meaning the thread executing the call waits for the response, or asynchrously meaning the thread continues and listens for the response. Its preferred to elimnate all sync calls to reduce any potential disruption to a user's experience within the application.

The Monitor tool helps by identifying these requests and calling them out. These call outs can be found in the "Performance" category as shown below.

<insert performance sync xhr sent> 

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/Performance.SyncCall-Full.PNG" style="zoom: 80%;" />

Examining the performance entry, we can see the "dataSource" property shows the XmlHttpRequest URL. However, it doesn't show the source of the call which is needed to better understand how and why the request was made. For that, we need to find the 

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/Performance.SyncCall-Xhr-sync-property.PNG" style="zoom: 80%;" />

Here is a gif showing how to use the Monitor tool, coupled with the Browser Developer Tools to locate the line of code that needs to be updated.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/FullLoad-Perf-SyncXhr.gif" style="zoom: 80%;" />

### Save for later

Reviewing the image below (I've added the commented out timeline events for reference), we can see the calculation for PageNavigationModuleReady is represented by the difference between the timeline event for the KPI and the WorkStart timeline event.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/PerfCenter/ExportAsJson.PNG" style="zoom: 80%;" />

## Timeline Zones



## Next Steps

In this article we covered 