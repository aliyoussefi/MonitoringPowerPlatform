# Monitoring the Power Platform: Model Driven Apps - Monitoring Tool Part 1: 

## Summary

The idea of monitoring Dynamics 365 or Model Driven Applications is not a new concept. Understanding where services are failing, users are running into errors, where form and business processes could be tuned for performance are key drivers for most if not all businesses, from small companies to enterprises. Luckily, the Dynamics 365 platform provides many tools to help audit and monitor business and operational events.

This article will cover locating and downloading environment analytics using the Common Data Service for Analytics. Questions regarding capacity and all up usage can be answered here. For operational events the Release Wave 1 2020 for Power Apps will be explored for feature announcement to allow for both manual and automated gathering. For specific activities or workloads within the platform we will explore tools to capture and explain performance markers.

## Collecting User Interface Events

Before we discuss techniques on how to capture events in Dynamics 365 let's examine some meaningful events. From the client perspective this may include performance counters and metrics, user click events and navigation as well as geolocations and preferences of users. 



Some features of the platform allow for collecting markers while other events of interest we will have to supplement with custom delivery mechanisms. Upcoming articles will detail how to collect and push events of interest to a central area for analytics.

### The Monitoring Tool

The Monitoring Tool can be launched from the Power Apps Maker Portal. Once launched, the Play Model Driven App button can be pressed to begin a session attached to the tool.

<insert play button>

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/PlayModelDrivenApp.PNG" style="zoom: 80%;" />

The monitoring tool can also be started by adding “**&monitor=true**” to the URL of your Model Driven Application.

After consenting or allowing to start a session, the Monitoring Tool will light up rapidly with various messages. Similar to the <insert canvas app monitor link> article, each row can be further drilled into for investigation.

<show drilled image - Full Load>

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/RowDetailFullLoad.PNG" style="zoom: 80%;" />

Jesse Parsons' article on the Monitoring Tool, titled '' provides a through deep dive into the Monitoring Tool. I highly suggest reviewing and keeping close by for reference.

## Key Performance Indicators

Key Performance Indicators represent major lifecycle events within a particular user action, such as loading a form. Consider the image below.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/FormLoad-KPIs.PNG" style="zoom: 80%;" />

By sorting the records on "KPI", these events begin to emerge. The image below shows the major lifecycle events or KPIs for a standard form load within Dynamics 365. Beginning with PageNavigationStart and ending with RenderedEditReady, these events represent the completion of a Key Performance Indicator.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/KPI-HighLevel.PNG" style="zoom: 80%;" />

### Scenario: Determining a Form's Load Impact

Consider the scenario of a user logging into the system and opening a lead form for the first time. When performing this action the form and data have not had a chance to be cached or stored locally which results in all items needed to be downloaded. This is sometimes referenced as a cold load. Reviewing the timeline event "**FullLoad**" we can determine what type of load the form rendered as.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-FormLoad-ColdLoad-JSON.JPG)

Now, once captured, the user opens the fly out window to choose another lead record but using the same form. Again using the "**FullLoad**" KPI timeline event we can see the ***LoadType*** is now **two**.

![](https://raw.githubusercontent.com/wiki/aliyoussefi/D365-Monitoring/Artifacts/Dynamics/D365-FormLoad-WarmLoad-JSON.JPG)

Finally, imagine the user needs to navigate back to the original lead record opened on the same form. We can see now the ***LoadType*** is now **three**. Comparing this to the ***LoadType*** 0 image above, the **entityId** is the same.

Here is a sample scenario in full showing the differences in loading new and existing records and how changing a form can impact network requests to the server.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/FullLoad-LoadTypeAndMetadataNetworkRequestExample.gif" style="zoom: 80%;" />

## Attribution

On certain **Key Performance Indicators** a property is included called "***Attribution***" which represents specific lifecycle events. This includes the commands or actions included within a KPI. For example, during a form load lifecycle, controls are rendered, ribbon rule are evaluated, onload event handlers are executed, etc. The Attribution property will specify and group,in chronological order, which events happened. An added bonus is the duration is also shown for each event along with if any synchronous calls were made. Consider the image below.

### Scenario: Locating dynamically added form changes and events

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/FullLoad.Attrition.PNG" style="zoom: 80%;" />

The image above shows for the ***FullLoad*** KPI. In this image we see three main groups of events: CustomControl (form controls), Rule Evaluation (ribbon rules) and onload (form event handlers). What's interesting here is each of these is grouped, but also the solution they are part of and event solution layering is present. The RuleEvaluation and onload groups above both show an unmanaged or "Active" layer that contained customizations.

Compare that image with the one below.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/SaveForm.Attribution.PNG" style="zoom: 80%;" />

A scenario came up during an investigation into the an increased duration of the FormSave KPI. Upon review, you can see additional events occurred, *tabstatechanged* and *onsave*. The onsave was expected due to the registered event handler on the form. **<u>However the tabstatechange was not, this was found to be due to a recent code addition that triggered the setDisplayState of the tab.</u>** 

<insert code>



In the above image, the Export button, located in the upper right hand corner will deliver the work block payload for further examination. Begin by choosing the work block to investigate, in the example above "EditForm" represents an entity record form open. Clicking the JSON or CSV button will produce an output which can then be saved as the desired file type.

By reviewing the Attribution property we were able to identify what caused the increase of 5 seconds.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/SaveForm.Attribution.TabStateChanged.PNG" style="zoom: 80%;" />

This tabstatechange Attribution wasn't found in the FullLoad KPI as expected. Actually it was found in a KPI called "EditForm". The next section of this article will briefly discuss another powerful tool that can be leveraged to collect metrics for the Dynamics 365 platform, the Performance Center.

### Performance Center

The Performance Center is a tool that's been around for many years and versions within the platform. A quick search online will show step by step instructions on how to bring it up and work with it.

<insert bing image>

In the above scenario, using both the Monitor Tool and the Performance Center, we were able to identify the root cause.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/PerfCenter/ExportAsJson.PNG" style="zoom: 80%;" />

## Performance Messages

Performance categorized messages detail potential performance issues that a user may run into. At the time of this writing, I've uncovered only synchronous XHR calls being sent but I anticipate growth here.

### Scenario: Locating and Evaluating Synchronous Resource Timings

Requests from a Model Driven App represent outgoing calls from the client to another source. These calls can occur either synchronously meaning the thread executing the call waits for the response, or asynchronously meaning the thread continues and listens for the response. Its preferred to eliminate all sync calls to reduce any potential disruption to a user's experience within the application.

The Monitor tool helps by identifying these requests and calling them out. These call outs can be found in the "Performance" category as shown below.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/Performance.SyncCall-Full.PNG" style="zoom: 80%;" />

Examining the performance entry, we can see the "dataSource" property shows the XmlHttpRequest URL. However, it doesn't show the source of the call which is needed to better understand how and why the request was made. For that, we need to find the 

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/Performance.SyncCall-Xhr-sync-property.PNG" style="zoom: 80%;" />

Here is a gif showing how to use the Monitor tool, coupled with the Browser Developer Tools to locate the line of code that needs to be updated.

<img src="https://raw.githubusercontent.com/aliyoussefi/MonitoringPowerPlatform/master/Artifacts/Dynamics/MonTool/FullLoad-Perf-SyncXhr.gif" style="zoom: 80%;" />

 Using these messages, along with outputs from Power Apps Checker, we can begin to uncover gaps in code analysis. In the next article, I'll cover in depth an approach to help identify and remediate these gaps.

## Next Steps

In this article we have covered how to work with the **Monitor** tool output files. **<u>Viewing within Power BI Dashboards, attaching to DevOps work items and storing in Azure backed log stores are all possibilities.</u>** Included [sample code](https://github.com/aliyoussefi/MonitoringPowerPlatform/tree/master/Samples) and **Kusto** queries to help you get started have also been provided.

This article showcases use cases and strategies for working with the **Monitor** tool but really only represents the tip of the iceberg. Continue collecting, examining and churning the output for deep insight into user and platform trends.

If you are interested in learning more about [**specialized guidance and training** for monitoring or other areas of the Power Platform](https://community.dynamics.com/crm/b/crminthefield/posts/pfe-dynamics-365-service-offerings), which includes a [monitoring workshop](https://community.dynamics.com/cfs-file/__key/communityserver-blogs-components-weblogfiles/00-00-00-17-38/WorkshopPLUS-_2D00_-Dynamics-365-Customer-Engagement-Monitoring-with-Application-lnsights-1-Day-with-Lab_2D00_FA5D599F_2D00_20E4_2D00_4087_2D00_A713_2D00_39FBD14DF7E5.pdf), please contact your **Technical Account Manager** or **Microsoft representative** for further details. 

Your feedback is **<u>extremely valuable</u>** so please leave a comment below and I'll be happy to help where I can! Also, if you find any inconsistencies, omissions or have suggestions, [please go here to submit a new issue](https://github.com/aliyoussefi/MonitoringPowerPlatform/issues).

## Index

[Monitoring the Power Platform: Introduction and Index](https://community.dynamics.com/crm/b/crminthefield/posts/monitoring-the-power-platform-introduction)